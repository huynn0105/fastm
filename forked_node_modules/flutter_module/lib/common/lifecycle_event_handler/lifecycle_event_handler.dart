import 'package:flutter/material.dart';
import 'package:flutter_module/common/enum/tracking_event_type.dart';
import 'package:flutter_module/di/get_it.dart';
import 'package:flutter_module/features/app_cubit.dart';
import 'package:flutter_module/features/notification/cubit/push_notification/push_notification_cubit.dart';

final lifecycleEventHandler = LifecycleEventHandler._();

class LifecycleEventHandler extends WidgetsBindingObserver {
  AppLifecycleState? appState;

  LifecycleEventHandler._();

  init() {
    WidgetsBinding.instance.addObserver(lifecycleEventHandler);
  }

  @override
  Future<void> didChangeAppLifecycleState(AppLifecycleState state) async {
    appState = state;
    switch (state) {
      case AppLifecycleState.resumed:
        _onForegroundHandler();
        break;
      case AppLifecycleState.inactive:
      case AppLifecycleState.paused:
      case AppLifecycleState.detached:
        _onBackgroundHandler();
        break;
      case AppLifecycleState.hidden:
        break;
    }
  }

  _onForegroundHandler() {
    getItInstance.get<AppCubit>().trackingEvent(event: TrackingEventType.appRefresh);
    getItInstance.get<AppCubit>().moengagePlugin.initialise();
    getItInstance.get<PushNotificationCubit>().refreshUnreadCount();
  }

  _onBackgroundHandler() {
    ///
  }

  static void handleState({
    required AppLifecycleState state,
    Function()? onForeground,
    Function()? onBackground,
  }) {
    switch (state) {
      case AppLifecycleState.resumed:
        onForeground?.call();
        break;
      case AppLifecycleState.inactive:
      case AppLifecycleState.paused:
      case AppLifecycleState.detached:
        onBackground?.call();
        break;
      case AppLifecycleState.hidden:
        break;
    }
  }
}
