import 'package:flutter/services.dart';
import 'package:intl/intl.dart';

class CurrencyInputFormatter extends TextInputFormatter {
  CurrencyInputFormatter(
    this.max, {
    this.enableReplacedMax = true,
  });

  final int max;
  final bool enableReplacedMax;

  @override
  TextEditingValue formatEditUpdate(TextEditingValue oldValue, TextEditingValue newValue) {
    int value = int.tryParse(newValue.text.replaceAll('.', '')) ?? 0;
    var result = '';
    var text = (value > max && enableReplacedMax) ? '$max' : newValue.text.replaceAll(RegExp(r"[^0-9]"), '');

    if (text != '') {
      if (text.length == 2 && text.startsWith('0', 0)) {
        result = text.substring(1, 2);
      } else {
        result = _formatNumber('vi', text.replaceAll('.', ''));
      }
    }

    return TextEditingValue(
      text: result,
      selection: TextSelection.collapsed(offset: result.length),
    );
  }

  String _formatNumber(String locale, String s) {
    return NumberFormat.decimalPattern(locale).format(int.parse(s));
  }
}
