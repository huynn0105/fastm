import 'package:collection/collection.dart';
import 'package:flutter/material.dart';
import 'package:flutter_module/common/colors.dart';
import 'package:flutter_module/common/styles.dart';

import '../../../models/master_data/time_frame_model.dart';
import '../../widgets/buttons.dart';
import '../../widgets/checkbox.dart';
import 'bottom_sheet_view.dart';

class ReceiveTimeView extends StatefulWidget {
  const ReceiveTimeView({
    Key? key,
    required this.selectData,
    required this.data,
  }) : super(key: key);

  final List<TimeFrameModel> selectData;
  final List<TimeFrameModel> data;

  @override
  State<ReceiveTimeView> createState() => _MultiSelectGroupSearchViewState();
}

class _MultiSelectGroupSearchViewState extends State<ReceiveTimeView> {

  late List<TimeFrameModel> selectedData;

  @override
  void initState() {
    super.initState();
    selectedData = List<TimeFrameModel>.from(widget.selectData);
  }

  @override
  Widget build(BuildContext context) {
    return BottomSheetView(
      title: 'Chọn khung thời gian',
      enabledOnDone: enabledOnDone,
      onDone: () {
        Navigator.of(context).pop(selectedData);
      },
      child: Container(
        padding: const EdgeInsets.only(top: 20, bottom: 16, left: 16, right: 16),
        color: UIColors.background,
        child: Column(
          mainAxisSize: MainAxisSize.min,
          children: [
            ListView.separated(
              physics: const NeverScrollableScrollPhysics(),
              padding: EdgeInsets.zero,
              shrinkWrap: true,
              itemBuilder: (context, index) {
                final item = widget.data[index];
                final isSelected = selectedData.map((e) => e.id).contains(item.id);
                return AppSplashButton(
                  onTap: () {
                    onSelected(item);
                  },
                  child: Container(
                    alignment: Alignment.center,
                    child: IgnorePointer(
                      ignoring: true,
                      child: AppCheckbox.rectangle(
                        value: isSelected,
                        title: item.getTitle(),
                        onChanged: (_) {},
                      ),
                    ),
                  ),
                );
              },
              separatorBuilder: (context, index) {
                return const SizedBox(height: 16,);
              },
              itemCount: widget.data.length,
            ),
            Container(
              height: 1,
              margin: const EdgeInsets.only(top: 16, bottom: 12),
              color: UIColors.white,
            ),
            Text(
              'Lưu ý: không hỗ trợ giao hàng vào\nchủ nhật và ngày lễ',
              textAlign: TextAlign.center,
              style: UITextStyle.bold.copyWith(
                fontSize: 16,
                color: UIColors.orange,
              ),
            ),
            const SizedBox(height: 24,),
          ],
        ),
      ),
    );
  }

  onSelected(TimeFrameModel item) {
    bool isSelected = selectedData.firstWhereOrNull((e) => e.id == item.id) != null;
    setState(() {
      if (isSelected) {
        selectedData.removeWhere((e) => e.id == item.id);
      } else {
        selectedData.add(item);
      }
    });
  }

  bool get enabledOnDone => selectedData.isNotEmpty;
}
