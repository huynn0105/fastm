import 'package:expandable/expandable.dart';
import 'package:flutter/material.dart';

import '../colors.dart';
import '../styles.dart';
import 'buttons.dart';
import 'images.dart';

class ExpandableColumn extends StatelessWidget {
  const ExpandableColumn({
    Key? key,
    required this.builder,
    this.showExpand = true,
    this.scrollOnExpand = true,
    this.scrollOnCollapse = true,
    this.padding = const EdgeInsets.fromLTRB(16, 0, 16, 0),
    this.backgroundColor = UIColors.white,
    this.borderRadius = const BorderRadius.all(Radius.circular(12)),
    this.footer,
    this.initialExpanded = false,
  }) : super(key: key);

  final Widget Function(BuildContext context, bool expanded) builder;
  final bool showExpand;
  final bool scrollOnExpand;
  final bool scrollOnCollapse;
  final EdgeInsets padding;
  final Color backgroundColor;
  final BorderRadius borderRadius;
  final Widget Function(BuildContext context, bool expanded, ExpandableController controller)? footer;
  final bool initialExpanded;

  @override
  Widget build(BuildContext context) {
    return ExpandableNotifier(
      initialExpanded: initialExpanded,
      child: ScrollOnExpand(
        scrollOnExpand: scrollOnExpand,
        scrollOnCollapse: scrollOnCollapse,
        child: Container(
          padding: padding,
          decoration: BoxDecoration(
            color: backgroundColor,
            borderRadius: borderRadius,
          ),
          child: Builder(
            builder: (context) {
              final controller = ExpandableController.of(context, required: true)!;
              return Column(
                children: [
                  Expandable(
                    collapsed: builder(context, controller.expanded),
                    expanded: builder(context, controller.expanded),
                  ),
                  if (showExpand)
                    if (footer != null)
                      footer!(context, controller.expanded, controller)
                    else
                      _DefaultFooter(controller: controller),
                ],
              );
            },
          ),
        ),
      ),
    );
  }
}

class _DefaultFooter extends StatelessWidget {
  const _DefaultFooter({
    Key? key,
    required this.controller,
  }) : super(key: key);

  final ExpandableController controller;

  @override
  Widget build(BuildContext context) {
    return SplashButton(
      onTap: controller.toggle,
      child: Row(
        mainAxisSize: MainAxisSize.min,
        children: [
          SizedBox(
            height: 40,
            child: Center(
              child: Text(
                controller.expanded ? "Thu gọn" : "Xem thêm",
                style: UITextStyle.regular.copyWith(
                  color: UIColors.primaryColor,
                ),
              ),
            ),
          ),
          const SizedBox(
            width: 4,
          ),
          const AppImage.asset(
            asset: "ic_arrow_right",
            width: 20,
            height: 20,
            color: UIColors.primaryColor,
          ),
        ],
      ),
    );
  }
}
