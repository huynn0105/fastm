import 'package:auto_route/auto_route.dart';
import 'package:flutter_module/routes/routes.gr.dart';
import 'package:flutter_module/services/local/local_data_helper.dart';

import '../app_data.dart';

class AuthGuard extends AutoRouteGuard {
  @override
  void onNavigation(NavigationResolver resolver, StackRouter router) {
    if (LocalDataHelper.instance.getIsOnboarding()) {
      resolver.redirect(const OnboardingRoute());
    } else {
      resolver.next(true);
    }
    // if (TextUtils.isNotEmpty(AppData.instance.accessToken)) {
    //   resolver.next(true);
    // } else {
    //   resolver.redirect(
    //     LoginRoute(
    //       onSuccess: () {
    //         resolver.resolveNext(true, reevaluateNext: false);
    //       },
    //     ),
    //   );
    // }
  }
}

class InitialDeepLinkHandlerGuard extends AutoRouteGuard {
  @override
  void onNavigation(NavigationResolver resolver, StackRouter router) {
    resolver.next(true);
    Future.delayed(const Duration(milliseconds: 200), () {
      if (AppData.instance.initialDeepLinkURI != null) {
        String initialDeepLinkURI = AppData.instance.initialDeepLinkURI!;
        AppData.instance.initialDeepLinkURI = null;
        router.pushNamed(initialDeepLinkURI);
      }
    });
  }
}
