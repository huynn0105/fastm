import 'package:flutter_module/app_data.dart';
import 'package:flutter_module/features/notification/repository/notification_repository.dart';
import 'package:flutter_module/services/api/notification/payload/register_fcm_token_payload.dart';
import 'package:flutter_module/services/local/local_data_helper.dart';

class DeviceToken {
  DeviceToken._();

  static DeviceToken instance = DeviceToken._();

  String? fcmToken;

  setFCMToken(String? token) {
    fcmToken = token;
    syncToServer();
  }

  deleteFcmToken() async {
    if (fcmToken != null) {
      // await ApiProvider.instance.notificationApi.deleteDeviceToken(
      //   deviceToken: fcmToken!,
      // );
    }
  }

  syncToServer() async {
    final String? userID = LocalDataHelper.instance.getUser()?.id;
    if (fcmToken != null && userID != null) {
      await NotificationRepository().registerFcmToken(
        RegisterFcmTokenPayload(
          userId: userID,
          fcmToken: fcmToken,
          deviceUdid: AppData.instance.deviceUDID,
        ),
      );
    }
  }
}
