import 'package:flutter/material.dart';
import 'package:flutter_module/common/enum/mfast/notification_category.dart';
import 'package:flutter_module/common/extension/datetime_extension.dart';
import 'package:flutter_module/common/extension/list_extension.dart';
import 'package:flutter_module/common/size.dart';
import 'package:flutter_module/common/widgets/loadmore_widget.dart';
import 'package:flutter_module/features/notification/page/notification/items/notification_item.dart';
import 'package:flutter_module/models/mfast/notification/mfast_notification_model.dart';

class ListNotificationComponent extends StatelessWidget {
  const ListNotificationComponent({
    super.key,
    required this.data,
    required this.category,
    this.onRefresh,
    this.onLoadMore,
  });

  final List<MFastNotificationModel> data;
  final NotificationCategory category;
  final Future Function()? onRefresh;
  final Future Function()? onLoadMore;

  @override
  Widget build(BuildContext context) {
    return LoadMoreWidget(
      onRefresh: onRefresh,
      onLoadMore: onLoadMore,
      child: ListView(
        padding: EdgeInsets.only(
          left: 16,
          right: 16,
          bottom: AppSize.instance.safeBottom + 16,
        ),
        children: [
          ...List.generate(data.length, (index) {
            final item = data[index];
            final prevItem = data.valueAt(index - 1);
            bool isDiffDay;
            if (prevItem != null) {
              final currentDay =
                  DateTime.fromMillisecondsSinceEpoch((item.createdDate ?? 0) * 1000, isUtc: false).dateOnly();
              final prevDay =
                  DateTime.fromMillisecondsSinceEpoch((prevItem.createdDate ?? 0) * 1000, isUtc: false).dateOnly();
              isDiffDay = currentDay.difference(prevDay).inDays != 0;
            } else {
              // first item
              isDiffDay = true;
            }
            return NotificationItem(
              item: item,
              hideFlag: category.isSystem,
              isDiffDay: isDiffDay,
            );
          }),
        ],
      ),
    );
  }
}
