import 'package:flutter/material.dart';
import 'package:flutter_bloc/flutter_bloc.dart';
import 'package:flutter_module/common/size.dart';
import 'package:flutter_module/features/account/cubit/user/user_cubit.dart';
import 'package:flutter_module/features/legendary/cubit/legendary_hier_user_info/legendary_hier_user_info_cubit.dart';
import 'package:flutter_module/features/personal_setting/pages/personal_setting/components/user_info_component.dart';

import '../../../../../common/colors.dart';
import '../../../../../common/styles.dart';
import '../../../../../common/widgets/images.dart';

class PersonalSettingAppBar extends StatelessWidget {
  const PersonalSettingAppBar({
    Key? key,
    this.hasLoggedIn = false,
  }) : super(key: key);

  final bool hasLoggedIn;

  @override
  Widget build(BuildContext context) {
    double backgroundSize = AppSize.instance.safeTop + 58;
    double appBarSize = backgroundSize + (hasLoggedIn ? 88 : 0);
    return SizedBox(
      height: appBarSize,
      child: Stack(
        children: [
          Positioned(
            top: 0,
            left: 0,
            right: 0,
            child: Container(
              height: backgroundSize,
              padding: const EdgeInsets.all(16),
              decoration: const BoxDecoration(
                borderRadius: BorderRadius.only(
                  bottomLeft: Radius.circular(15),
                  bottomRight: Radius.circular(15),
                ),
                gradient: LinearGradient(
                  begin: Alignment(1, -1),
                  end: Alignment(-1, 1),
                  colors: UIColors.primaryGradient,
                ),
              ),
              child: buildOption(context),
            ),
          ),
          Positioned(
            bottom: 0,
            left: 0,
            right: 0,
            child: UserInfoComponent(
              hasLoggedIn: hasLoggedIn,
            ),
          ),
        ],
      ),
    );
  }

  buildOption(BuildContext context) {
    if (!hasLoggedIn) {
      return const Align(
        alignment: Alignment.bottomLeft,
        child: AppImage.asset(
          asset: "ic_name_logo_mfast",
          width: 86,
          height: 24,
        ),
      );
    }
    return Align(
      alignment: Alignment.bottomCenter,
      child: Column(
        mainAxisSize: MainAxisSize.min,
        children: [
          Row(
            mainAxisAlignment: MainAxisAlignment.spaceBetween,
            children: [
              Text(
                "Xin chào!!!",
                style: UITextStyle.regular.copyWith(
                  fontSize: 12,
                  color: const Color(0xffd6deff).withOpacity(0.6),
                ),
              ),
              Text(
                "Mã MFast",
                style: UITextStyle.regular.copyWith(
                  fontSize: 12,
                  color: const Color(0xffd6deff).withOpacity(0.6),
                ),
              ),
            ],
          ),
          Row(
            mainAxisAlignment: MainAxisAlignment.spaceBetween,
            children: [
              BlocBuilder<LegendaryHierUserInfoCubit, LegendaryHierUserInfoState>(
                builder: (context, state) {
                  return Text(
                    state.data?.rank?.level?.title ?? '',
                    style: UITextStyle.semiBold.copyWith(
                      fontSize: 16,
                      color: const Color(0xffd6deff),
                    ),
                  );
                },
              ),
              BlocBuilder<UserCubit, UserState>(
                builder: (context, state) {
                  return Text(
                    state.userInfo?.referralCode ?? '',
                    style: UITextStyle.semiBold.copyWith(
                      fontSize: 16,
                      color: const Color(0xffd6deff),
                    ),
                  );
                },
              ),
            ],
          ),
        ],
      ),
    );
  }
}
