import 'package:flutter/material.dart';
import 'package:flutter_bloc/flutter_bloc.dart';
import 'package:flutter_module/features/statistic_working/cubit/statistic_asm_report/statistic_asm_report_cubit.dart';
import 'package:flutter_module/features/statistic_working/page/statistic_working/mixins/statistic_working_mixin.dart';
import 'package:flutter_module/models/statistic_working/statistic_checking_model.dart';

import '../../../../../common/enum/statistic_working/statistic_working_level.dart';
import '../../statistic_working/components/statistic_list_component.dart';
import '../items/statistic_report_item.dart';

class StatisticTotalReportComponent extends StatelessWidget with StatisticWorkingMixin {
  const StatisticTotalReportComponent({
    super.key,
    this.level,
    this.name,
    this.header,
    this.sortList,
  });

  final String? level;
  final String? name;
  final Widget? header;
  final List<FilterSortList>? sortList;

  @override
  Widget build(BuildContext context) {
    return BlocBuilder<StatisticAsmTotalReportCubit, StatisticAsmReportState>(
      builder: (context, state) {
        return StatisticListComponent(
          level: level,
          name: name,
          header: header,
          status: state.status,
          data: state.data,
          filterSortList: sortList,
          filterTitle: 'báo cáo',
          onFilterResult: (data) {
            context.read<StatisticAsmTotalReportCubit>()
              ..updatePayload(
                sortList: data.id,
              )
              ..fetchData();
          },
          onItemBuilder: (context, item, index) {
            return StatisticReportItem(
              item: item,
              onTap: () {
                openReport(context, userID: item.userID, level: item.level);
              },
            );
          },
          onTitleDisplayed: (level, name) {
            return 'Thống kê các ${StatisticWorkingLevel.getUnderLevel(level)} của ${name ?? ''}';
          },
          onRefresh: context.read<StatisticAsmTotalReportCubit>().refreshData,
          onLoadMore: context.read<StatisticAsmTotalReportCubit>().loadmoreData,
          onSearchChanged: context.read<StatisticAsmTotalReportCubit>().onSearch,
        );
      },
    );
  }
}
