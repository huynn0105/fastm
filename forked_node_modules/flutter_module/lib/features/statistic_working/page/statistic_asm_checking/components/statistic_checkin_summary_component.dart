import 'package:flutter/material.dart';
import 'package:flutter_bloc/flutter_bloc.dart';
import 'package:info_popup/info_popup.dart';

import '../../../../../common/colors.dart';
import '../../../../../common/styles.dart';
import '../../../../../common/widgets/buttons.dart';
import '../../../../../common/widgets/images.dart';
import '../../../cubit/statistic_summary_checking/statistic_summary_checking_cubit.dart';
import '../../statistic_working/widget/statistic_checking_value_widget.dart';
import 'checking_info_popup.dart';

class StatisticCheckInSummaryComponent extends StatefulWidget {
  const StatisticCheckInSummaryComponent({
    super.key,
    this.onControllerCreated,
    this.showInfoPopup,
  });

  final OnControllerCreated? onControllerCreated;
  final VoidCallback? showInfoPopup;

  @override
  State<StatisticCheckInSummaryComponent> createState() => _StatisticCheckInSummaryComponentState();
}

class _StatisticCheckInSummaryComponentState extends State<StatisticCheckInSummaryComponent> {
  bool _showInfoPopup = false;

  @override
  Widget build(BuildContext context) {
    return BlocBuilder<StatisticSummaryCheckingCubit, StatisticSummaryCheckingState>(
      builder: (context, state) {
        return CheckingInfoPopup(
          onControllerCreated: widget.onControllerCreated,
          onDismissed: () {
            setState(() {
              _showInfoPopup = false;
            });
          },
          child: Container(
            padding: const EdgeInsets.symmetric(vertical: 10, horizontal: 12),
            decoration: BoxDecoration(
              color: UIColors.lightSecondaryColor,
              borderRadius: BorderRadius.circular(8),
              border: Border.all(
                color: UIColors.white,
              ),
            ),
            child: Column(
              children: [
                Stack(
                  children: [
                    Align(
                      alignment: Alignment.center,
                      child: Text(
                        'Kết quả điểm danh trong ngày',
                        style: UITextStyle.semiBold.copyWith(
                          fontSize: 14,
                          color: UIColors.accentOrange,
                        ),
                      ),
                    ),
                    Align(
                      alignment: Alignment.centerRight,
                      child: SplashButton(
                        isDisabled: _showInfoPopup,
                        onTap: () {
                          setState(() {
                            _showInfoPopup = true;
                          });
                          widget.showInfoPopup?.call();
                        },
                        child: AppImage.asset(
                          asset: _showInfoPopup ? 'ic_info_fill' : 'ic_info_outline',
                          width: 24,
                          height: 24,
                          color: _showInfoPopup ? UIColors.primaryColor : null,
                        ),
                      ),
                    )
                  ],
                ),
                const SizedBox(height: 10),
                StatisticCheckingValueWidget(
                  level: state.data?.level ?? '',
                  data: state.data?.checkingDetail,
                  isHeader: true,
                ),
              ],
            ),
          ),
        );
      },
    );
  }
}
