import 'package:flutter/material.dart';

import 'package:flutter_module/common/colors.dart';
import 'package:flutter_module/common/enum/statistic_working/statistic_working_type.dart';
import 'package:flutter_module/common/styles.dart';
import 'package:flutter_module/common/utils/text_util.dart';
import 'package:flutter_module/common/widgets/avatar_widget.dart';
import 'package:flutter_module/features/statistic_working/page/statistic_working/widget/info_widget.dart';
import 'package:flutter_module/features/statistic_working/page/statistic_working/widget/lastest_action_widget.dart';

class UserInfoWidget extends StatelessWidget {
  const UserInfoWidget({
    super.key,
    required this.userID,
    required this.avatarURL,
    required this.fullName,
    required this.phoneNumber,
    required this.lineLabel,
    required this.statisticType,
    this.lastestActionTime,
    this.footer,
    this.onTypeSwitched,
  });

  final String userID;
  final String avatarURL;
  final String fullName;
  final String phoneNumber;
  final String lineLabel;
  final String statisticType;
  final String? lastestActionTime;
  final Widget? footer;
  final Function(StatisticWorkingType type)? onTypeSwitched;

  @override
  Widget build(BuildContext context) {
    return Container(
      width: double.infinity,
      margin: const EdgeInsets.only(top: 24),
      constraints: const BoxConstraints(minHeight: 100),
      decoration: BoxDecoration(
        color: UIColors.darkBlue,
        borderRadius: BorderRadius.circular(12),
      ),
      child: Stack(
        clipBehavior: Clip.none,
        children: [
          Positioned(
            top: -24,
            left: 0,
            right: 0,
            child: Center(
              child: Container(
                width: 81,
                height: 81,
                decoration: BoxDecoration(
                  shape: BoxShape.circle,
                  color: UIColors.lightGray,
                  border: Border.all(color: UIColors.white),
                ),
                child: AvatarWidget(
                  url: avatarURL,
                  size: 80,
                ),
              ),
            ),
          ),
          Container(
            alignment: Alignment.center,
            padding: const EdgeInsets.fromLTRB(12, 68, 12, 12),
            child: Column(
              crossAxisAlignment: CrossAxisAlignment.center,
              children: [
                Text(
                  fullName,
                  style: UITextStyle.medium.copyWith(
                    fontSize: 16,
                    color: UIColors.white,
                  ),
                ),
                const SizedBox(
                  height: 4,
                ),
                ContactInfoWidget(
                  phoneNumber: phoneNumber,
                  userID: userID,
                  lineLabel: lineLabel,
                ),
                if (TextUtils.isNotEmpty(lastestActionTime)) ...[
                  const SizedBox(
                    height: 4,
                  ),
                  LastestActionWidget(
                    statisticType: statisticType,
                    date: lastestActionTime!,
                  ),
                ],
                if (footer != null) ...[
                  const SizedBox(
                    height: 4,
                  ),
                  footer!,
                ],
              ],
            ),
          ),
          Visibility(
            visible: statisticType == StatisticWorkingType.report.code,
            child: Positioned(
              top: 12,
              left: 12,
              child: StatisticTypeWidget(
                title: 'Thống kê\nđiểm danh',
                asset: 'ic_location_selected',
                textDirection: TextDirection.ltr,
                onTap: () {
                  onTypeSwitched?.call(StatisticWorkingType.checking);
                },
              ),
            ),
          ),
          Visibility(
            visible: statisticType == StatisticWorkingType.checking.code,
            child: Positioned(
              top: 12,
              right: 12,
              child: StatisticTypeWidget(
                title: 'Thống kê\ncông việc',
                asset: 'ic_paper',
                textDirection: TextDirection.rtl,
                onTap: () {
                  onTypeSwitched?.call(StatisticWorkingType.report);
                },
              ),
            ),
          ),
        ],
      ),
    );
  }
}
