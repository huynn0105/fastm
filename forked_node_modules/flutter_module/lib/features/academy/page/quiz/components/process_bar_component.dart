import 'dart:math';

import 'package:flutter/material.dart';
import 'package:flutter_module/common/colors.dart';
import 'package:flutter_module/common/styles.dart';

class ProcessBarComponent extends StatefulWidget {
  final int maxQuiz;
  final int currentQuiz;
  final double width;

  const ProcessBarComponent({
    super.key,
    this.maxQuiz = 1,
    this.currentQuiz = 0,
    this.width = 0,
  });

  @override
  State<ProcessBarComponent> createState() => _ProcessBarComponentState();
}

class _ProcessBarComponentState extends State<ProcessBarComponent>
    with TickerProviderStateMixin {
  late double currentValue;

  @override
  void initState() {
    super.initState();
    currentValue = widget.currentQuiz / widget.maxQuiz;
  }

  @override
  void didUpdateWidget(covariant ProcessBarComponent oldWidget) {
    if (oldWidget.currentQuiz != widget.currentQuiz) {
      setState(() {
        currentValue = widget.currentQuiz / widget.maxQuiz;
      });
    }
    super.didUpdateWidget(oldWidget);
  }

  @override
  void dispose() {
    super.dispose();
  }

  @override
  Widget build(BuildContext context) {
    return Column(
      crossAxisAlignment: CrossAxisAlignment.end,
      children: [
        Container(
          alignment: Alignment.centerLeft,
          clipBehavior: Clip.hardEdge,
          decoration: BoxDecoration(
            borderRadius: BorderRadius.circular(24),
            color: UIColors.lightGray,
          ),
          width: widget.width,
          height: 6,
          child: AnimatedContainer(
            duration: const Duration(seconds: 1),
            width: currentValue * widget.width,
            height: 6,
            decoration: BoxDecoration(
              borderRadius: BorderRadius.circular(24),
              color: UIColors.primaryColor,
            ),
          ),
        ),
        const SizedBox(height: 4),
        RichText(
          text: TextSpan(
            style: DefaultTextStyle.of(context).style,
            children: [
              TextSpan(
                text: widget.currentQuiz.toString(),
                style: UITextStyle.bold.copyWith(),
              ),
              TextSpan(
                text: " / ${widget.maxQuiz.toString()}",
                style: UITextStyle.regular.copyWith(color: UIColors.grayText),
              ),
            ],
          ),
        )
      ],
    );
  }
}
