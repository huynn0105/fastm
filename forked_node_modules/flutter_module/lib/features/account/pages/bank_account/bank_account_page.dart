import 'package:auto_route/auto_route.dart';
import 'package:flutter/material.dart';
import 'package:flutter_bloc/flutter_bloc.dart';
import 'package:flutter_module/common/colors.dart';
import 'package:flutter_module/common/constants.dart';
import 'package:flutter_module/common/widgets/appbar.dart';
import 'package:flutter_module/common/widgets/tabbar/tabbar.dart';
import 'package:flutter_module/features/account/pages/bank_account/cubit/bank_account/bank_account_cubit.dart';
import 'package:flutter_module/models/personal_setting/tile_data.dart';
import 'package:flutter_module/routes/routes.gr.dart';

@RoutePage()
class BankAccountPage extends StatelessWidget implements AutoRouteWrapper {
  const BankAccountPage({
    super.key,
    @QueryParam("initKey") this.initIndex,
  });

  final int? initIndex;

  @override
  Widget wrappedRoute(BuildContext context) {
    return BlocProvider(
      create: (_) {
        final cubit = BankAccountCubit();
        cubit.getListBankAccount();
        cubit.getMetaDataBIDV();
        return cubit;
      },
      child: this,
    );
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: MFastSimpleAppBar(
        context: context,
        title: 'Tài khoản ngân hàng',
      ),
      body: AutoTabsRouter.tabBar(
        physics: AppConstants.physics,
        routes: const [
          BankAccountTabRoute(),
          TaxTabRoute(),
        ],
        builder: (context, child, tabController) {
          int initIndex = (this.initIndex ?? 0).clamp(0, 1);
          return Column(
            children: [
              UnderlineIconIndicatorTabbar(
                controller: tabController,
                initIndex: initIndex,
                backgroundColor: UIColors.background,
                height: 70,
                isScrollable: false,
                iconSize: 28,
                onIndexSelected: (index) {
                  tabController.animateTo(index);
                },
                tiles: [
                  TileData(
                    title: "Tài khoản NH",
                    icon: "ic_bank",
                  ),
                  TileData(
                    title: "Mã số thuế",
                    icon: "ic_tax",
                  ),
                ],
              ),
              Expanded(
                child: child,
              ),
            ],
          );
        },
      ),
    );
  }
}
