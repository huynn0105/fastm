import 'package:boxy/slivers.dart';
import 'package:collection/collection.dart';
import 'package:flutter/material.dart';
import 'package:flutter_module/common/enum/income/history_income_status.dart';
import 'package:flutter_module/common/utils/datetime_util.dart';
import 'package:flutter_module/common/widgets/sliver_list.dart';
import 'package:flutter_module/features/account/pages/income/children/history/items/history_income_item.dart';
import 'package:flutter_module/features/account/pages/income/children/history/items/tax_holding_item.dart';
import 'package:flutter_module/models/income/history_income_item_model.dart';
import 'package:flutter_module/models/income/tax_holding_model.dart';

import '../../../../../../../common/colors.dart';

class HistoryComponent extends StatelessWidget {
  const HistoryComponent({
    Key? key,
    required this.data,
    this.taxHolding,
  }) : super(key: key);

  final TaxHoldingModel? taxHolding;
  final List<HistoryIncomeItemModel> data;

  @override
  Widget build(BuildContext context) {
    return SliverContainer(
      margin: const EdgeInsets.only(top: 16),
      background: Container(
        decoration: BoxDecoration(
          color: UIColors.white,
          borderRadius: BorderRadius.circular(8),
        ),
      ),
      sliver: taxHolding != null
          ? SliverToBoxAdapter(
              child: TaxHoldingItem(
                data: taxHolding,
              ),
            )
          : SeparatedSliverList(
              itemCount: data.length,
              itemBuilder: (context, index) {
                final item = data[index];
                final status = HistoryIncomeStatus.values.firstWhereOrNull((e) => e.status == item.status);

                ///
                return HistoryIncomeItem(
                  code: item.id ?? "",
                  title: item.transTitle ?? "",
                  creditAmount: item.creditAmount ?? 0.0,
                  balanceAmount: item.newBalance ?? 0.0,
                  elapsedTime: DateTimeUtil.getNumberDayBetween(
                    item.transDate ?? "",
                    forceShowDateFormat: (duration) {
                      if (duration.inDays > 3) {
                        return DateTimeFormat.dd__MM__yyyy;
                      }
                      return null;
                    },
                  ),
                  status: status ?? HistoryIncomeStatus.pending,
                );
              },
              separatorBuilder: (_, __) {
                return const Divider(
                  height: 0,
                  color: UIColors.lightGray,
                  indent: 12,
                  endIndent: 12,
                );
              },
            ),
      // sliver: SliverList(
      //   delegate: SliverChildBuilderDelegate(
      //     (context, index) {
      //       if (index.isOdd) {
      //         return const Divider(
      //           height: 0,
      //           color: UIColors.lightGray,
      //           indent: 12,
      //           endIndent: 12,
      //         );
      //       }
      //       return data[index ~/ 2];
      //     },
      //     childCount: data.length * 2 - 1,
      //   ),
      // ),
    );
  }

  // List<Widget> get data {
  //   return [
  //     const HistoryIncomeItem(
  //       code: "13579",
  //       title: "Tất toàn thu nhập tháng 12/2022 về TKNH Vietcombank - Cao Phương Đức - 0924141444",
  //       creditAmount: 250000,
  //       balanceAmount: 6500000,
  //       elapsedTime: "3 phút trước",
  //       status: HistoryIncomeStatus.success,
  //     ),
  //     const HistoryIncomeItem(
  //       code: "02468",
  //       title: "Rút tiền về TKNH Vietcombank - Cao Phương Đức - 0924141444",
  //       creditAmount: -1500000,
  //       balanceAmount: 8200000,
  //       elapsedTime: "2 giờ trước",
  //       status: HistoryIncomeStatus.pending,
  //     ),
  //     const HistoryIncomeItem(
  //       code: "02468",
  //       title: "Rút tiền về TKNH Vietcombank - Cao Phương Đức - 0924141444",
  //       creditAmount: 1500000,
  //       balanceAmount: 8200000,
  //       elapsedTime: "2 giờ trước",
  //       status: HistoryIncomeStatus.failure,
  //     ),
  //   ];
  // }
}
