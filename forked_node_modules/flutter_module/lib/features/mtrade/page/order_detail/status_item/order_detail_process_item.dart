import 'package:auto_route/auto_route.dart';
import 'package:flutter/material.dart';
import 'package:flutter_module/common/colors.dart';
import 'package:flutter_module/common/styles.dart';
import 'package:flutter_module/common/utils/datetime_util.dart';
import 'package:flutter_module/common/widgets/buttons.dart';
import 'package:flutter_module/features/mtrade/page/mtrade/widgets/mtrade_block_widget.dart';
import 'package:flutter_module/features/shipper/page/detail_bill_lading/items/history_item.dart';
import 'package:flutter_module/models/mtrade/order/mtrade_order_detail_model.dart';

class OrderDetailProcessItem extends StatelessWidget {
  const OrderDetailProcessItem({
    super.key,
    required this.data,
  });

  final MTradeOrderDetailModel? data;

  @override
  Widget build(BuildContext context) {
    return Column(
      children: [
        MTradeBlockWidget(
          childPadding: const EdgeInsets.symmetric(horizontal: 16),
          titlePadding: const EdgeInsets.symmetric(horizontal: 16),
          spacing: 8,
          title: 'Lịch sử thay đổi trạng thái',
          child: Container(
            padding: const EdgeInsets.symmetric(horizontal: 1),
            decoration: BoxDecoration(
              borderRadius: BorderRadius.circular(8),
              color: UIColors.white,
            ),
            child: ListView.builder(
              shrinkWrap: true,
              physics: const NeverScrollableScrollPhysics(),
              itemCount: data?.history?.length ?? 0,
              padding: EdgeInsets.zero,
              itemBuilder: (context, index) {
                final item = data?.history?.reversed.toList()[index];

                return Stack(
                  children: [
                    if (index == 0)
                      Positioned.fill(
                          child: Container(
                        color: UIColors.extraLightBlue,
                        margin: const EdgeInsets.only(top: 8),
                      )),
                    HistoryItem(
                      date: DateTimeUtil.convertTodayDate(
                        item?.updatedDate,
                        fromFormat: DateTimeFormat.yyyy_MM_dd_HH_mm_ss,
                        toFormat: DateTimeFormat.dd_MM_yyyy_n_HH_mm,
                        isFromUtc: false,
                      ),
                      title: item?.stateName ?? '',
                      label: '${item?.processText ?? ''}${item?.processText?.isNotEmpty == true && item?.processNote?.isNotEmpty == true ? ' - ' : ''}${item?.processNote ?? ''}',
                      icon: item?.icon ?? '',
                      lineColor: UIColors.lightBlue,
                      dotSize: 6,
                      dotColor: index == 0 ? UIColors.darkBlue : UIColors.darkGray,
                      titleColor: index == 0 ? UIColors.darkBlue : UIColors.darkGray,
                      labelColor: UIColors.darkGray,
                      iconColor: index == 0 ? null : UIColors.darkGray,
                      dateColor: UIColors.darkGray,
                      contentsPadding: EdgeInsets.only(left: 8, top: index == 0 ? 20 : 12, bottom: 12),
                      oppositeContentsPadding: EdgeInsets.only(right: 8, top: index == 0 ? 20 : 12, bottom: 12),
                      labelStyle: index == 0
                          ? UITextStyle.semiBold.copyWith(
                              fontSize: 13,
                              color: index == 0
                                  ? UIColors.darkBlue
                                  : UIColors.darkGray,
                            )
                          : null,
                    ),
                  ],
                );
              },
            ),
          ),
        ),
        const SizedBox(
          height: 20,
        ),
        PrimaryButton(
          onPressed: () {
            context.popRoute();
          },
          title: 'Quay lại',
        )
      ],
    );
  }
}
