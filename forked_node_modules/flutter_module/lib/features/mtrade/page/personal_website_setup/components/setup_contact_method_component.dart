import 'package:auto_route/auto_route.dart';
import 'package:flutter/material.dart';
import 'package:flutter_module/common/constants.dart';
import 'package:flutter_module/common/enum/mtrade/website_setup_contact_method.dart';
import 'package:flutter_module/common/widgets/collect_data_view.dart';
import 'package:flutter_module/common/widgets/textfields.dart';

import '../../../../../app_data.dart';
import '../../../../../common/colors.dart';
import '../../../../../common/styles.dart';
import '../../../../../common/widgets/buttons.dart';
import '../../../../../common/widgets/checkbox.dart';
import '../../../../../routes/routes.gr.dart';
import '../../mtrade/children/brochure/widgets/requirement_widget.dart';

class SetupContactMethodComponent extends StatelessWidget {
  const SetupContactMethodComponent({
    Key? key,
    required this.data,
    required this.onSelected,
    required this.onMessengerChanged,
    required this.messengerController,
    required this.errorFields,
  }) : super(key: key);

  final List<String> data;
  final Function(String code) onSelected;
  final Function(String text) onMessengerChanged;
  final TextEditingController messengerController;
  final Map<String, String> errorFields;

  @override
  Widget build(BuildContext context) {
    final selectedPhone = data.contains(WebsiteSetupContactMethod.socialPhone.name);
    final selectedZalo = data.contains(WebsiteSetupContactMethod.socialZalo.name);
    final selectedFacebook = data.contains(WebsiteSetupContactMethod.socialFacebook.name);
    final errorMethodMessage = errorFields[AppConstants.websiteSetupContactMethodKey];
    final errorMethodMessengerMessage = errorFields[AppConstants.websiteSetupContactMethodMessengerKey];
    final hasMethodError = errorMethodMessage != null;

    ///
    return RequirementWidget(
      title: "Phương thức liên hệ",
      child: Column(
        children: [
          AnimatedSize(
            duration: AppConstants.duration,
            alignment: Alignment.topCenter,
            child: Visibility(
              visible: hasMethodError,
              child: Padding(
                padding: const EdgeInsets.only(bottom: 14),
                child: ErrorText(
                  errorMsg: errorMethodMessage,
                ),
              ),
            ),
          ),
          AppCheckbox.rectangle(
            value: selectedPhone,
            title: "Gọi trực tiếp vào SĐT trên",
            isError: hasMethodError,
            onChanged: (_) {
              onSelected(WebsiteSetupContactMethod.socialPhone.name);
            },
          ),
          const SizedBox(
            height: 14,
          ),
          AppCheckbox.rectangle(
            value: selectedZalo,
            title: "Liên hệ qua Zalo với SĐT trên",
            isError: hasMethodError,
            onChanged: (_) {
              onSelected(WebsiteSetupContactMethod.socialZalo.name);
            },
          ),
          Row(
            children: [
              Expanded(
                child: AppCheckbox.rectangle(
                  value: selectedFacebook,
                  title: "Liên hệ qua Messenger",
                  isError: hasMethodError,
                  onChanged: (_) {
                    onSelected(WebsiteSetupContactMethod.socialFacebook.name);
                  },
                ),
              ),
              AppSplashButton(
                onTap: () {
                  context.pushRoute(
                    WebViewBottomSheetRoute(
                      url: AppData.instance.configs?.product?.socialFacebookGuide ?? "",
                      title: "Hướng dẫn",
                      showTitle: false,
                    ),
                  );
                },
                child: Padding(
                  padding: const EdgeInsets.symmetric(vertical: 14),
                  child: Text(
                    "Hướng dẫn",
                    style: UITextStyle.regular.copyWith(
                      fontSize: 14,
                      color: UIColors.primaryColor,
                    ),
                  ),
                ),
              ),
            ],
          ),
          AnimatedSize(
            duration: AppConstants.duration,
            alignment: Alignment.topCenter,
            child: Visibility(
              visible: selectedFacebook,
              child: Container(
                margin: const EdgeInsets.only(left: 32),
                padding: const EdgeInsets.symmetric(horizontal: 16, vertical: 12),
                decoration: BoxDecoration(
                  borderRadius: BorderRadius.circular(8),
                  color: UIColors.background,
                ),
                child: CollectDataView(
                  errorMsg: errorMethodMessengerMessage,
                  child: UITextField(
                    controller: messengerController,
                    labelText: "Địa chỉ Messenger",
                    prefixText: AppConstants.prefixMessengerDomain,
                    onChanged: onMessengerChanged,
                  ),
                ),
              ),
            ),
          ),
        ],
      ),
    );
  }
}
