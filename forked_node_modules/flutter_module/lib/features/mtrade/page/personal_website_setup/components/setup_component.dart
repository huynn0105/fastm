import 'package:flutter/material.dart';
import 'package:flutter_bloc/flutter_bloc.dart';
import 'package:flutter_module/common/bottom_sheet/wrapper/data_wrapper.dart';
import 'package:flutter_module/common/constants.dart';
import 'package:flutter_module/common/enum/mtrade/delivery_location_type.dart';
import 'package:flutter_module/common/global_function.dart';
import 'package:url_launcher/url_launcher.dart';
import '../../../../../common/colors.dart';
import '../../../../../common/styles.dart';
import '../../../../../common/widgets/buttons.dart';
import '../../../../../models/mtrade/personal_website_setup/mtrade_personal_website_setup_model.dart';
import '../../../cubit/personal_website_setup/mtrade_personal_website_setup_cubit.dart';
import 'setup_contact_information_component.dart';
import 'setup_contact_method_component.dart';
import 'setup_location_component.dart';

class SetupComponent extends StatelessWidget {
  const SetupComponent({
    Key? key,
    required this.data,
  }) : super(key: key);

  final MTradePersonalWebsiteSetupModel? data;

  @override
  Widget build(BuildContext context) {
    final cubit = context.read<MTradePersonalWebsiteSetupCubit>();
    return BlocBuilder<MTradePersonalWebsiteSetupCubit, MTradePersonalWebsiteSetupState>(
      builder: (context, state) {
        return Padding(
          padding: const EdgeInsets.symmetric(horizontal: 16),
          child: Column(
            crossAxisAlignment: CrossAxisAlignment.start,
            children: [
              Text(
                "Thiết lập thông tin liên hệ trên Website",
                style: UITextStyle.medium.copyWith(
                  fontSize: 16,
                  color: UIColors.grayText,
                ),
              ),
              const SizedBox(
                height: 8,
              ),
              Container(
                padding: const EdgeInsets.all(16),
                decoration: BoxDecoration(
                  borderRadius: BorderRadius.circular(8),
                  color: UIColors.white,
                ),
                child: Column(
                  children: [
                    SetupLocationComponent(
                      enabledProvince: state.enabledProvince,
                      enabledDistrict: state.enabledDistrict,
                      enabledWard: state.enabledWard,
                      selectedProvinceCode: state.selectedProvinceCode ?? "",
                      selectedDistrictCode: state.selectedDistrictCode ?? "",
                      selectedWardCode: state.selectedWardCode ?? "",
                      provinces: state.provinces,
                      districts: state.districts,
                      wards: state.wards,
                      provinceController: cubit.provinceController,
                      districtController: cubit.districtController,
                      wardController: cubit.wardController,
                      onSelected: (LocationType type, DataWrapper result) {
                        if (type.isProvince) {
                          cubit.selectProvince(result.id ?? "");
                        } else if (type.isDistrict) {
                          cubit.selectDistrict(result.id ?? "");
                        } else if (type.isWard) {
                          cubit.selectWard(result.id ?? "");
                        }
                      },
                      errorFields: state.errorFields,
                    ),
                    const SizedBox(
                      height: 20,
                    ),
                    SetupContactInformationComponent(
                      name: data?.fullName ?? "",
                      phone: data?.mobilePhone ?? "",
                    ),
                    const SizedBox(
                      height: 20,
                    ),
                    SetupContactMethodComponent(
                      messengerController: cubit.messengerController,
                      data: state.selectedContactMethodCodes,
                      onSelected: cubit.changeContactMethod,
                      onMessengerChanged: cubit.changeMessengerAddress,
                      errorFields: state.errorFields,
                    ),
                  ],
                ),
              ),
              const SizedBox(
                height: 24,
              ),
              Row(
                children: [
                  Expanded(
                    child: AppOutlinedButton(
                      enabled: state.enabledSave,
                      onPressed: () {
                        GlobalFunction.action(
                          context: context,
                          onTap: () {
                            cubit.save(
                              onSuccess: () {
                                GlobalFunction.launchScheme(
                                  state.data?.sortLink ?? "",
                                  mode: LaunchMode.externalApplication,
                                );
                              },
                            );
                          },
                        );
                      },
                      height: 48,
                      title: "Xem thử",
                      borderWidth: 1,
                      textColor: state.enabledSave ? UIColors.primaryColor : UIColors.darkGray,
                      borderColor: UIColors.primaryColor,
                      backgroundColor: Colors.transparent,
                      borderRadius: BorderRadius.circular(8),
                    ),
                  ),
                  const SizedBox(
                    width: 16,
                  ),
                  Expanded(
                    child: PrimaryButton(
                      onPressed: () {
                        GlobalFunction.action(
                          context: context,
                          onTap: () {
                            cubit.save();
                          },
                        );
                      },
                      enabled: state.enabledSave,
                      height: 48,
                      radius: 8,
                      title: "Lưu thiết lập",
                    ),
                  ),
                ],
              ),
            ],
          ),
        );
      },
    );
  }
}
