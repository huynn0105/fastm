import 'package:flutter/foundation.dart';
import 'package:flutter/material.dart';
import 'package:flutter_bloc/flutter_bloc.dart';
import 'package:flutter_module/app_data.dart';
import 'package:flutter_module/common/bloc_status.dart';
import 'package:flutter_module/di/get_it.dart';
import 'package:flutter_module/env_data.dart';
import 'package:flutter_module/features/mtrade/cubit/personal_website_setup/mtrade_personal_website_setup_cubit.dart';
import 'package:flutter_module/features/mtrade/cubit/product_detail/mtrade_product_detail_cubit.dart';
import 'package:flutter_module/features/mtrade/page/product_detail/components/app_bar_action_component.dart';

import 'package:universal_html/html.dart' as html;

class RenderProductAppBarComponent extends StatelessWidget {
  const RenderProductAppBarComponent({
    super.key,
    required this.onBack,
    required this.onHome,
    required this.onShare,
    required this.onCart,
  });

  final Function() onBack;
  final Function() onCart;
  final Function(String name, String url) onShare;
  final Function() onHome;

  @override
  Widget build(BuildContext context) {
    return BlocBuilder<MTradeProductDetailCubit, MTradeProductDetailState>(
      builder: (context, state) {
        final product = state.product;
        final isEmpty = product == null && !state.status.showLoading;

        ///
        return AppBarActionComponent(
          enabledShare: !isEmpty,
          onBack: onBack,
          onCart: onCart,
          onShare: () {
            String productLink = '';
            if (kIsWeb) {
              productLink = html.window.location.href;
            } else {
              Map<String, String> queryParameters = {
                "productCode": product?.code ?? '',
                "pageID": getItInstance.get<MTradePersonalWebsiteSetupCubit>().state.data?.pageID ?? '',
                "provinceCode": AppData.instance.deliverySupportProvinceCode ?? '',
                "districtCode": AppData.instance.deliverySupportDistrictCode ?? '',
                "wardCode": AppData.instance.deliverySupportWardCode ?? '',
              };
              productLink = Uri.parse('${EnvData.instance.webUrl}/product_detail')
                  .replace(queryParameters: queryParameters)
                  .toString();
            }
            onShare(product?.name ?? "", productLink);
          },
          onHome: onHome,
        );
      },
    );
  }
}
