import 'package:flutter/foundation.dart';
import 'package:flutter/material.dart';
import 'package:flutter_module/common/colors.dart';
import 'package:flutter_module/common/extension/list_extension.dart';
import 'package:flutter_module/common/styles.dart';
import 'package:flutter_module/common/utils/format_util.dart';
import 'package:flutter_module/features/mtrade/cubit/product_detail/mtrade_product_detail_cubit.dart';
import 'package:flutter_module/features/mtrade/page/product_detail/items/tip_payment_item.dart';

import '../../../../../common/widgets/images.dart';

class OverviewInformationComponent extends StatelessWidget {
  const OverviewInformationComponent({
    Key? key,
    required this.state,
  }) : super(key: key);

  final MTradeProductDetailState state;

  @override
  Widget build(BuildContext context) {
    final subtitle = state.product?.descShort ?? "";
    final comparePrice = state.skuDetail?.comparePrice ?? [];
    final price = state.skuDetail?.price ?? state.product?.price;
    final payNow = state.skuDetail?.payNow;
    final payLater = state.skuDetail?.payLater;

    if (state.product == null) {
      return const SizedBox();
    }

    return Container(
      padding: const EdgeInsets.fromLTRB(16, 0, 16, 16),
      decoration: const BoxDecoration(
        color: UIColors.white,
      ),
      child: Column(
        crossAxisAlignment: CrossAxisAlignment.start,
        children: [
          if (subtitle.isNotEmpty) ...[
            Text(
              subtitle,
              style: UITextStyle.regular.copyWith(
                fontSize: 14,
                color: UIColors.grayText,
              ),
            ),
          ],
          const SizedBox(
            height: 4,
          ),
          Row(
            crossAxisAlignment: CrossAxisAlignment.baseline,
            textBaseline: TextBaseline.alphabetic,
            children: [
              Text(
                FormatUtil.currencyFormat(price),
                style: UITextStyle.bold.copyWith(
                  fontSize: 18,
                  color: UIColors.red,
                ),
              ),
              if (comparePrice.isNotEmpty) ...[
                const SizedBox(
                  width: 10,
                ),
                Text(
                  comparePrice.valueAt(0)?.getValue() ?? "",
                  style: UITextStyle.regular.copyWith(
                    fontSize: 13,
                    color: UIColors.grayText,
                    decoration: TextDecoration.lineThrough,
                  ),
                ),
              ],
            ],
          ),
          if (state.skuDetail?.wholesale == true)
            Row(
              children: [
                const AppImage.asset(
                  asset: 'ic_success',
                  width: 20,
                  height: 20,
                ),
                const SizedBox(width: 4),
                Text(
                  'CÓ THỂ ÁP DỤNG GIÁ ĐẶC BIỆT',
                  style: UITextStyle.semiBold.copyWith(
                    color: UIColors.extraGreen,
                  ),
                )
              ],
            ),
          if (!kIsWeb)
            const SizedBox(
              height: 12,
            ),
          if (!kIsWeb)
            IntrinsicHeight(
              child: Row(
                crossAxisAlignment: CrossAxisAlignment.stretch,
                children: [
                  Expanded(
                    child: TipPaymentItem.now(
                      title: "Thu nhập bán trả ngay",
                      comm: payNow?.comm,
                      unsupported: state.product?.payNow?.comm == null || state.skuDetail?.payNow?.comm == null,
                    ),
                  ),
                  const SizedBox(
                    width: 10,
                  ),
                  Expanded(
                    child: TipPaymentItem.later(
                      title: "Thu nhập bán trả chậm",
                      comm: payLater?.comm,
                      unsupported: state.product?.payLater?.comm == null || state.skuDetail?.payLater?.comm == null,
                    ),
                  ),
                ],
              ),
            ),
        ],
      ),
    );
  }
}
