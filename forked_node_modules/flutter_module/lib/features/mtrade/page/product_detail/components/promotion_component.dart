import 'package:flutter/material.dart';
import 'package:flutter_bloc/flutter_bloc.dart';
import 'package:flutter_module/common/styles.dart';
import 'package:flutter_module/common/widgets/buttons.dart';
import 'package:flutter_module/common/widgets/images.dart';
import 'package:flutter_module/common/widgets/separated_widget.dart';
import 'package:flutter_module/features/mtrade/page/product_detail/widgets/promotion_card.dart';

import '../../../../../common/colors.dart';
import '../../../../../common/constants.dart';
import '../../../../../common/size.dart';
import '../../../cubit/promotion_product/mtrade_promotion_product_cubit.dart';

class PromotionComponent extends StatelessWidget {
  const PromotionComponent({
    super.key,
    this.showDivider = true,
  });

  final bool showDivider;

  @override
  Widget build(BuildContext context) {
    return BlocBuilder<MTradePromotionProductCubit, MTradePromotionProductState>(
      buildWhen: (pre, cur) {
        return pre.promotions != cur.promotions;
      },
      builder: (context, state) {
        final data = state.promotions;
        if (data.isEmpty) {
          return const SizedBox();
        }
        return Column(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            Visibility(
              visible: showDivider,
              child: Container(
                height: 5,
                width: double.infinity,
                color: UIColors.extraLightGray,
              ),
            ),
            const SizedBox(
              height: 16,
            ),
            Padding(
              padding: const EdgeInsets.symmetric(horizontal: 16),
              child: Row(
                children: [
                  Text(
                    "Ưu đãi từ MTrade",
                    style: UITextStyle.semiBold.copyWith(
                      fontSize: 16,
                    ),
                  ),
                  // const Spacer(),
                  // SplashButton(
                  //   onTap: () {},
                  //   child: const AppImage.asset(
                  //     asset: "ic_arrow_right",
                  //     width: 20,
                  //     height: 20,
                  //   ),
                  // ),
                ],
              ),
            ),
            const SizedBox(
              height: 12,
            ),
            SizedBox(
              width: double.infinity,
              child: data.length == 1
                  ? Padding(
                      padding: const EdgeInsets.symmetric(horizontal: 16),
                      child: PromotionCard(
                        data: data[0],
                        width: double.infinity,
                      ),
                    )
                  : SingleChildScrollView(
                      physics: AppConstants.physics,
                      scrollDirection: Axis.horizontal,
                      padding: const EdgeInsets.symmetric(horizontal: 16),
                      child: IntrinsicHeight(
                        child: SeparatedRow(
                          crossAxisAlignment: CrossAxisAlignment.stretch,
                          separatorBuilder: (BuildContext context, int index) {
                            return const SizedBox(
                              width: 12,
                            );
                          },
                          children: List.generate(
                            data.length,
                            (index) {
                              return PromotionCard(
                                data: data[index],
                                width: 275,
                              );
                            },
                          ),
                        ),
                      ),
                    ),
            ),
            const SizedBox(
              height: 16,
            ),
          ],
        );
      },
    );
  }
}
