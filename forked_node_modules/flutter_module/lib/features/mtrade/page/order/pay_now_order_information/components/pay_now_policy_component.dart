import 'package:auto_route/auto_route.dart';
import 'package:flutter/gestures.dart';
import 'package:flutter/material.dart';
import 'package:flutter_bloc/flutter_bloc.dart';
import 'package:flutter_module/common/widgets/buttons.dart';

import '../../../../../../app_data.dart';
import '../../../../../../common/colors.dart';
import '../../../../../../common/constants.dart';
import '../../../../../../common/styles.dart';
import '../../../../../../common/widgets/checkbox.dart';
import '../../../../../../common/widgets/collect_data_view.dart';
import '../../../../../../routes/routes.gr.dart';
import '../../../../cubit/pay_now_order_information/mtrade_pay_now_order_information_cubit.dart';

class PayNowPolicyComponent extends StatelessWidget {
  const PayNowPolicyComponent({Key? key}) : super(key: key);

  @override
  Widget build(BuildContext context) {
    final cubit = context.read<MTradePayNowOrderInformationCubit>();
    return BlocBuilder<MTradePayNowOrderInformationCubit, MTradePayNowOrderInformationState>(
      builder: (context, state) {
        return Padding(
          padding: const EdgeInsets.symmetric(horizontal: 16),
          child: CollectDataView(
            errorMsg: state.errorFields[AppConstants.orderPolicyKey],
            child: Row(
              crossAxisAlignment: CrossAxisAlignment.center,
              children: [
                AppSplashButton(
                  onTap: () {
                    cubit.changePolicy();
                  },
                  child: IgnorePointer(
                    ignoring: true,
                    child: AppCheckbox.rectangle(
                      value: state.acceptedPolicy,
                      size: 28,
                      onChanged: (_) {},
                    ),
                  ),
                ),
                const SizedBox(width: 12,),
                Expanded(
                  child: RichText(
                    text: TextSpan(
                      children: [
                        TextSpan(
                          text: "Tôi đã đọc và đồng ý với cam kết về ",
                          style: UITextStyle.regular.copyWith(
                            fontSize: 13,
                            height: 1,
                          ),
                        ),
                        TextSpan(
                          text: "điều khoản chia sẻ thông tin",
                          style: UITextStyle.regular.copyWith(
                            fontSize: 13,
                            color: UIColors.primaryColor,
                          ),
                          recognizer: TapGestureRecognizer()..onTap = () {
                            _onShowSheetTermsAndConditions(context);
                          },
                        ),
                      ],
                    ),
                  ),
                ),
              ],
            ),
          ),
        );
      },
    );
  }

  _onShowSheetTermsAndConditions(BuildContext context) {
    context.pushRoute(
      WebViewBottomSheetRoute(
        url: AppData.instance.configs?.product?.mplTermsAndConditions ?? "",
        title: "Thông tin điều khoản",
        showTitle: false,
      ),
    );
  }
}
