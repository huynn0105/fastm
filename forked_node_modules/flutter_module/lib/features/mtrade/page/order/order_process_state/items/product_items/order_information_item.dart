import 'package:flutter/material.dart';
import 'package:flutter_module/common/colors.dart';
import 'package:flutter_module/common/global_function.dart';
import 'package:flutter_module/common/styles.dart';
import 'package:flutter_module/common/utils/format_util.dart';
import 'package:flutter_module/common/widgets/buttons.dart';
import 'package:flutter_module/common/widgets/divider.dart';
import 'package:flutter_module/common/widgets/html_widget.dart';
import 'package:flutter_module/models/mtrade/order/order_model.dart';

import '../../../../../../../common/utils/datetime_util.dart';
import '../../../../../../../common/widgets/images.dart';
import '../status_items/status_items.dart';

class OrderInformationItem extends StatelessWidget {
  const OrderInformationItem({
    Key? key,
    required this.data,
    required this.processState,
  }) : super(key: key);

  final OrderModel data;
  final String processState;

  @override
  Widget build(BuildContext context) {
    final price = data.amountAfterTax ?? 0;
    final fullname = data.fullName ?? "";
    final phone = data.mobilePhone ?? "";
    final count = data.items?.map((e) => e.quantity ?? 0).toList().fold(0, (pre, cur) => pre + cur) ?? 0;
    final deliveryDate = data.trackingPartner?.getEstimatedDeliveryDate() ?? "";

    //
    return Column(
      children: [
        Row(
          children: [
            Text(
              "Tổng $count sản phẩm",
              style: UITextStyle.regular.copyWith(
                fontSize: 13,
                color: UIColors.grayText,
              ),
            ),
            const Spacer(),
            Text(
              "Thành tiền:",
              style: UITextStyle.regular.copyWith(
                fontSize: 13,
                color: UIColors.grayText,
              ),
            ),
            const SizedBox(
              width: 5,
            ),
            Text(
              FormatUtil.currencyFormat(price),
              style: UITextStyle.semiBold.copyWith(
                fontSize: 13,
                color: UIColors.red,
              ),
            ),
          ],
        ),
        const DottedDivider(
          height: 8,
        ),
        Table(
          columnWidths: const {
            0: FlexColumnWidth(1.1),
            1: FlexColumnWidth(2.5),
          },
          children: [
            TableRow(
              children: [
                Align(
                  alignment: Alignment.centerLeft,
                  child: Text(
                    "Thanh toán:",
                    style: UITextStyle.regular.copyWith(
                      fontSize: 13,
                      color: UIColors.grayText,
                    ),
                  ),
                ),
                HtmlWidget(
                  data: data.paymentMethodText ?? "",
                  lineHeight: 1.25,
                ),
              ],
            ),
            if (data.prepayAmount != null)
              TableRow(
                children: [
                  Text(
                    "Trả trước:",
                    style: UITextStyle.regular.copyWith(
                      fontSize: 13,
                      color: UIColors.grayText,
                    ),
                  ),
                  Text(
                    FormatUtil.currencyFormat(data.prepayAmount),
                    style: UITextStyle.regular.copyWith(
                      fontSize: 13,
                    ),
                  ),
                ],
              ),
            if (data.conversationFeeAmount != null)
              TableRow(
                children: [
                  Text(
                    "Phí chuyển đổi:",
                    style: UITextStyle.regular.copyWith(
                      fontSize: 13,
                      color: UIColors.grayText,
                    ),
                  ),
                  Text(
                    FormatUtil.currencyDoubleFormat(data.conversationFeeAmount),
                    style: UITextStyle.regular.copyWith(
                      fontSize: 13,
                    ),
                  ),
                ],
              ),
            if (data.loanAmount != null)
              TableRow(
                children: [
                  Text(
                    "Trả chậm:",
                    style: UITextStyle.regular.copyWith(
                      fontSize: 13,
                      color: UIColors.grayText,
                    ),
                  ),
                  RichText(
                    text: TextSpan(
                      children: [
                        TextSpan(
                          text: FormatUtil.currencyFormat(data.loanAmount),
                          style: UITextStyle.regular.copyWith(
                            fontSize: 13,
                          ),
                        ),
                        const WidgetSpan(
                          child: SizedBox(
                            width: 5,
                          ),
                        ),
                        TextSpan(
                          text: "(Bao gồm bảo hiểm)",
                          style: UITextStyle.regular.copyWith(
                            fontSize: 13,
                            color: UIColors.grayText,
                          ),
                        ),
                      ],
                    ),
                  ),
                ],
              ),
            TableRow(
              children: [
                Text(
                  "Khách hàng:",
                  style: UITextStyle.regular.copyWith(
                    fontSize: 13,
                    color: UIColors.grayText,
                  ),
                ),
                Row(
                  children: [
                    Expanded(
                      child: Text(
                        "$fullname - ${FormatUtil.phoneFormat(phone)}",
                        style: UITextStyle.regular.copyWith(
                          fontSize: 13,
                        ),
                      ),
                    ),
                    if (processState == 'advise')
                      SplashButton(
                        onTap: () {
                          GlobalFunction.launchPhone(phone);
                        },
                        child: const AppImage.asset(
                          asset: "ic_call_ringing",
                          width: 20,
                          height: 20,
                          color: UIColors.primaryColor,
                        ),
                      ),
                  ],
                ),
              ],
            ),
            TableRow(
              children: [
                Text(
                  "Ngày tạo:",
                  style: UITextStyle.regular.copyWith(
                    fontSize: 13,
                    color: UIColors.grayText,
                  ),
                ),
                Text(
                  DateTimeUtil.convertDate(
                    data.createdDate,
                    fromFormat: DateTimeFormat.yyyy_MM_dd_HH_mm_ss,
                    toFormat: DateTimeFormat.HH_mm_dd_MM_yyyy,
                    isFromUtc: false,
                  ),
                  style: UITextStyle.regular.copyWith(
                    fontSize: 13,
                    color: UIColors.grayText,
                  ),
                ),
              ],
            ),
            if (deliveryDate.isNotEmpty)
              TableRow(
                children: [
                  Text(
                    "Dự kiến giao:",
                    style: UITextStyle.regular.copyWith(
                      fontSize: 13,
                      color: UIColors.grayText,
                    ),
                  ),
                  Text(
                    deliveryDate,
                    style: UITextStyle.semiBold.copyWith(
                      fontSize: 13,
                      color: UIColors.red,
                    ),
                  ),
                ],
              ),
          ],
        ),
      ],
    );
  }
}
