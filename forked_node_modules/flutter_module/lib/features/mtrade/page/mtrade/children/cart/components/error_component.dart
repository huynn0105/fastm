import 'package:expandable/expandable.dart';
import 'package:flutter/material.dart';
import 'package:flutter_module/common/constants.dart';
import 'package:flutter_module/common/styles.dart';
import 'package:flutter_module/common/widgets/buttons.dart';
import 'package:flutter_module/common/widgets/images.dart';

import '../../../../../../../common/colors.dart';

class ErrorComponent extends StatelessWidget {
  const ErrorComponent({
    Key? key,
    required this.errorFields,
  }) : super(key: key);

  final Map<String, String> errorFields;

  @override
  Widget build(BuildContext context) {
    final selectErrorFields = errorFields.entries
        .where((e) {
          final keys = [
            AppConstants.ruleOnlyOneQuantityPerSku,
            AppConstants.ruleUnsupported,
          ];
          return keys.contains(e.key);
        })
        .map((e) => e.value)
        .toList();

    return AnimatedSize(
      duration: AppConstants.duration,
      alignment: Alignment.topCenter,
      child: Visibility(
        visible: selectErrorFields.isNotEmpty,
        child: Container(
          margin: const EdgeInsets.all(16),
          padding: const EdgeInsets.symmetric(horizontal: 8, vertical: 4),
          decoration: BoxDecoration(
            color: UIColors.lightRed,
            borderRadius: BorderRadius.circular(8),
          ),
          child: ExpandableNotifier(
            initialExpanded: false,
            child: ScrollOnExpand(
              child: Builder(
                builder: (context) {
                  final controller = ExpandableController.of(context, required: true)!;
                  return Column(
                    children: [
                      Row(
                        children: [
                          const AppImage.asset(
                            asset: "ic_notification",
                            width: 24,
                            height: 24,
                          ),
                          const SizedBox(
                            width: 10,
                          ),
                          Expanded(
                            child: Text(
                              "Không thỏa điều kiện trả chậm",
                              style: UITextStyle.semiBold.copyWith(
                                fontSize: 14,
                                color: UIColors.red,
                              ),
                            ),
                          ),
                          AppSplashButton(
                            onTap: controller.toggle,
                            child: Padding(
                              padding: const EdgeInsets.symmetric(vertical: 8),
                              child: AppImage.asset(
                                asset: controller.expanded ? "ic_mtrade_subtract" : "ic_mtrade_plus",
                                width: 24,
                                height: 24,
                              ),
                            ),
                          ),
                        ],
                      ),
                      ListView.separated(
                        shrinkWrap: true,
                        padding: EdgeInsets.zero,
                        physics: const NeverScrollableScrollPhysics(),
                        itemBuilder: (context, index) {
                          return Text(
                            selectErrorFields[index],
                            style: UITextStyle.regular.copyWith(
                              fontSize: 13,
                            ),
                          );
                        },
                        separatorBuilder: (_, __) => const SizedBox(
                          height: 5,
                        ),
                        itemCount: controller.expanded ? selectErrorFields.length : 0,
                      ),
                      const SizedBox(
                        height: 4,
                      ),
                    ],
                  );
                },
              ),
            ),
          ),
        ),
      ),
    );
  }
}
