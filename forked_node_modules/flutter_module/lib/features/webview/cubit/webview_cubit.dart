import 'package:bloc/bloc.dart';
import 'package:equatable/equatable.dart';
import 'package:flutter_module/common/enum/webview/webview_error_type.dart';
import '../../../common/platform_view_registry/platform_registry.dart';

part 'webview_state.dart';

class WebViewCubit extends Cubit<WebViewState> {
  WebViewCubit() : super(const WebViewState());

  bool _isClosed = false;

  showLoading() {
    emit(state.copyWith(showLoading: true));
  }

  hideLoading() {
    emit(state.copyWith(showLoading: false));
  }

  initFrame(String url) async {
    final iframeKey = PlatformRegistry().initFrame(url);
    emit(state.copyWith(
      iframeKey: iframeKey,
    ));
  }

  clearErrorType() {
    emit(state.copyWith(
      clearErrorType: true,
    ));
  }

  changeErrorType(WebViewErrorType type) {
    emit(state.copyWith(
      errorType: type,
    ));
  }

  @override
  void emit(WebViewState state) {
    if (!_isClosed) {
      super.emit(state);
    }
  }

  @override
  Future<void> close() {
    _isClosed = true;
    return super.close();
  }
}
