import 'package:auto_route/auto_route.dart';
import 'package:flutter/material.dart';
import 'package:flutter_bloc/flutter_bloc.dart';
import 'package:flutter_module/common/bloc_status.dart';
import 'package:flutter_module/features/webview/webview_page.dart';

import '../../common/widgets/loading.dart';
import '../../services/api/mtrade/payload/mtrade_pay_now_order_payload.dart';
import 'cubit/order_payment_method/order_payment_method_cubit.dart';

@RoutePage(name: 'WebViewPaymentMethodBottomSheetRoute')
class WebViewPaymentMethodBottomSheet extends StatelessWidget {
  const WebViewPaymentMethodBottomSheet({
    Key? key,
    this.title = "Chọn phương thức thanh toán",
    this.wardCode,
    this.districtCode,
    this.provinceCode,
    this.totalAmount,
    this.orderItems,
  }) : super(key: key);

  final String title;
  final String? wardCode;
  final String? districtCode;
  final String? provinceCode;
  final double? totalAmount;
  final List<OrderItems>? orderItems;

  @override
  Widget build(BuildContext context) {
    return BlocProvider(
      create: (_) => MTradeOrderPaymentMethodCubit(),
      child: BlocBuilder<MTradeOrderPaymentMethodCubit, MTradeOrderPaymentMethodState>(
        builder: (context, state) {
          if (state.status.isInitial) {
            context.read<MTradeOrderPaymentMethodCubit>().getPaymentMethodUrl(
                  wardCode: wardCode,
                  districtCode: districtCode,
                  provinceCode: provinceCode,
                  totalAmount: totalAmount,
                  orderItems: orderItems,
                );
          }
          if (state.status.isInitial || state.status.isLoading) {
            return const LoadingWidget.dark();
          }
          return WebViewPage(
            url: state.url,
            title: title,
            showTitle: false,
            needDecode: false,
          );
        },
      ),
    );
  }
}
