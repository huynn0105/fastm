part of '../time_checking_report_detail_page.dart';

class _TimeCheckingReportDetailViewMode extends StatelessWidget {
  const _TimeCheckingReportDetailViewMode({
    super.key,
    required this.workingReports,
    required this.projectReports,
    required this.isFinalSubmit,
    required this.enabledEdit,
    this.onEdit,
  });

  final List<ReportModel> workingReports;
  final List<ReportModel> projectReports;
  final bool isFinalSubmit;
  final bool enabledEdit;
  final VoidCallback? onEdit;

  @override
  Widget build(BuildContext context) {
    return Column(
      children: [
        WorkingReportComponent(
          data: workingReports,
        ),
        Visibility(
          visible: workingReports.isNotEmpty && projectReports.isNotEmpty,
          child: const SizedBox(
            height: 16,
          ),
        ),
        ProjectReportComponent(
          data: projectReports,
        ),
        const SizedBox(
          height: 24,
        ),
        Padding(
          padding: const EdgeInsets.symmetric(horizontal: 16),
          child: PrimaryButton(
            onPressed: () => _onPrimaryTap(context),
            title: isFinalSubmit ? 'Xác nhận báo cáo' : 'Quay lại',
            height: 48,
            width: double.infinity,
          ),
        ),
        Visibility(
          visible: isFinalSubmit || enabledEdit,
          child: AppSplashButton(
            onTap: () {
              if (enabledEdit) {
                onEdit?.call();
              } else {
                context.router.pop();
              }
            },
            child: Container(
              height: 48,
              width: 150,
              alignment: Alignment.center,
              child: Text(
                'Chỉnh sửa báo cáo',
                style: UITextStyle.semiBold.copyWith(
                  fontSize: 14,
                  color: UIColors.primaryColor,
                ),
              ),
            ),
          ),
        ),
        SizedBox(
          height: max(24, AppSize.instance.safeBottom),
        ),
      ],
    );
  }

  _onPrimaryTap(BuildContext context) {
    final cubit = context.read<TimeCheckingReportDetailCubit>();
    if (cubit.state.isFinalSubmit) {
      DialogProvider.instance.showMTradeDialog(
        context: context,
        asset: 'ic_mtrade_mascot_happy_waiting',
        title: 'Xác nhận báo cáo',
        titleColor: UIColors.accentOrange,
        enableAutoPop: true,
        message: 'Lưu ý: thông tin trên báo cáo sẽ không thể thay đổi sau khi bấm xác nhận',
        messageAlign: TextAlign.left,
        messageColor: UIColors.defaultText,
        positiveTitle: 'Xác nhận',
        negativeTitle: 'Kiểm tra lại',
        positiveCallback: () => cubit.submitReport(),
        borderRadius: 50,
        negativeCallback: () {},
      );
      return;
    }
    context.router.pop();
  }
}
