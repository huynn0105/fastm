import 'dart:math';

import 'package:flutter/material.dart';
import 'package:flutter_module/common/colors.dart';
import 'package:flutter_module/common/constants.dart';
import 'package:flutter_module/common/size.dart';
import 'package:flutter_module/common/styles.dart';
import 'package:flutter_module/common/widgets/buttons.dart';
import 'package:flutter_module/common/widgets/images.dart';
import 'package:flutter_module/common/widgets/loading.dart';
import 'package:flutter_module/common/widgets/textfields.dart';

class SupportRequestComponent extends StatefulWidget {
  const SupportRequestComponent({
    super.key,
    this.defaultNote,
  });

  final String? defaultNote;

  @override
  State<SupportRequestComponent> createState() => _SupportRequestComponentState();
}

class _SupportRequestComponentState extends State<SupportRequestComponent> {
  TextEditingController controller = TextEditingController();

  @override
  void initState() {
    super.initState();
    controller.addListener(() {
      setState(() {});
    });
    controller.text =
        widget.defaultNote ?? 'Tôi đã định danh tài khoản nhiều lần nhưng vẫn không được, nhờ admin hỗ trợ kiểm tra!';
  }

  @override
  Widget build(BuildContext context) {
    return Stack(
      alignment: Alignment.bottomCenter,
      children: [
        LayoutBuilder(
          builder: (context, constraints) {
            return Column(
              mainAxisSize: MainAxisSize.min,
              children: [
                Container(
                  height: 6,
                  width: 92,
                  decoration: BoxDecoration(
                    borderRadius: BorderRadius.circular(3),
                    color: UIColors.white,
                  ),
                ),
                const SizedBox(
                  height: 10,
                ),
                Container(
                  width: constraints.maxWidth >= AppConstants.responsiveSize ? AppConstants.responsiveSize : null,
                  decoration: const BoxDecoration(
                    color: UIColors.extraLightGray,
                    borderRadius: BorderRadius.only(
                      topLeft: Radius.circular(24),
                      topRight: Radius.circular(24),
                    ),
                  ),
                  child: Column(
                    children: [
                      Container(
                        decoration: const BoxDecoration(
                          color: UIColors.white,
                          borderRadius: BorderRadius.only(
                            topLeft: Radius.circular(24),
                            topRight: Radius.circular(24),
                          ),
                          boxShadow: [
                            BoxShadow(
                              offset: Offset(0, 1),
                              color: UIColors.extraLightGray,
                              blurRadius: 1,
                            )
                          ],
                        ),
                        height: 48,
                        child: Stack(
                          children: [
                            Positioned(
                              top: 12,
                              left: 0,
                              right: 0,
                              bottom: 14,
                              child: Text(
                                'Yêu cầu hỗ trợ',
                                textAlign: TextAlign.center,
                                style: UITextStyle.medium.copyWith(
                                  fontSize: 16,
                                  color: UIColors.grayText,
                                ),
                              ),
                            ),
                            Positioned(
                              top: 12,
                              right: 12,
                              child: SplashButton(
                                onTap: () => Navigator.pop(context),
                                child: const AppImage.asset(
                                  asset: 'ic_close',
                                  height: 24,
                                  width: 24,
                                ),
                              ),
                            ),
                          ],
                        ),
                      ),
                      const Divider(
                        height: 1,
                        color: UIColors.lightGray,
                      ),
                      Padding(
                        padding: const EdgeInsets.symmetric(horizontal: 16),
                        child: Column(
                          children: [
                            const SizedBox(
                              height: 16,
                            ),
                            const AppImage.asset(
                              asset: 'mfast_question',
                              width: 126,
                              height: 95,
                            ),
                            const SizedBox(
                              height: 12,
                            ),
                            Text(
                              'Thông tin được đọc từ hình và video mà bạn cung cấp. Để hoàn tất định danh vui lòng thử thao tác lại hoặc tạo một yêu cầu để được MFast hỗ trợ',
                              style: UITextStyle.regular.copyWith(
                                fontSize: 16,
                                color: UIColors.grayText,
                              ),
                              textAlign: TextAlign.center,
                            ),
                            const SizedBox(
                              height: 20,
                            ),
                            SizedBox(
                              height: 80,
                              child: UITextFieldOutline(
                                controller: controller,
                                hintText: 'Nhập yêu cầu hỗ trợ',
                                maxLines: 10,
                                contentPadding: const EdgeInsets.all(12),
                                textStyle: UITextStyle.regular,
                              ),
                            ),
                            const SizedBox(
                              height: 20,
                            ),
                            Row(
                              children: [
                                Expanded(
                                  child: AppOutlinedButton(
                                    onPressed: () {
                                      Navigator.of(context).pop();
                                    },
                                    height: 48,
                                    borderRadius: BorderRadius.circular(48),
                                    backgroundColor: Colors.transparent,
                                    title: 'Quay lại',
                                    textColor: UIColors.grayText,
                                  ),
                                ),
                                const SizedBox(
                                  width: 12,
                                ),
                                Expanded(
                                  child: PrimaryButton(
                                    enabled: controller.text.isNotEmpty,
                                    onPressed: () {
                                      Navigator.of(context).pop(controller.text);
                                    },
                                    height: 48,
                                    title: 'Yêu cầu hỗ trợ',
                                  ),
                                )
                              ],
                            ),
                            SizedBox(
                              height: [AppSize.instance.safeBottom, 20].reduce(max).toDouble(),
                            ),
                          ],
                        ),
                      )
                    ],
                  ),
                ),
                SizedBox(
                  height: MediaQuery.of(context).viewInsets.bottom,
                ),
              ],
            );
          },
        ),
        const Visibility(
          visible: false,
          child: LoadingWidget.dark(),
        ),
      ],
    );
  }
}
