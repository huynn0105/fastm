import 'package:flutter/material.dart';
import 'package:flutter_module/common/colors.dart';
import 'package:flutter_module/common/dialogs/dialog_provider.dart';
import 'package:flutter_module/common/styles.dart';
import 'package:flutter_module/common/widgets/buttons.dart';
import 'package:flutter_module/common/widgets/images.dart';
import 'package:flutter_module/features/mfast/cubit/time_checking_report/time_checking_report_cubit.dart';
import 'package:flutter_module/models/mfast/report/report_model.dart';

class ButtonSelect extends StatelessWidget {
  const ButtonSelect({
    super.key,
    this.type = 'hoạt động',
    required this.selected,
    required this.maxLenght,
    required this.onRemove,
    required this.onShowBottomSheet,
  });

  final String type;
  final List<ReportItemField> selected;
  final int maxLenght;
  final Function(String reportId) onRemove;
  final VoidCallback onShowBottomSheet;

  @override
  Widget build(BuildContext context) {
    return Column(
      crossAxisAlignment: CrossAxisAlignment.start,
      children: [
        Text(
          'Bạn muốn báo cáo cho $type nào?',
          style: UITextStyle.semiBold.copyWith(
            fontSize: 16,
            color: UIColors.accentBlue,
          ),
        ),
        const SizedBox(height: 8),
        AppSplashButton(
          onTap: onShowBottomSheet,
          child: Container(
            decoration: BoxDecoration(
              color: UIColors.white,
              borderRadius: BorderRadius.circular(12),
              border: Border.all(color: selected.isNotEmpty ? UIColors.lightGray : UIColors.accentRed, width: 1),
            ),
            padding: const EdgeInsets.symmetric(horizontal: 16, vertical: 12),
            child: Row(
              children: [
                Expanded(
                  child: selected.isNotEmpty
                      ? Text(
                          selected.length == maxLenght
                              ? 'Đã chọn tất cả $type'
                              : selected.length == 1
                                  ? selected.first.report.title
                                  : 'Đã chọn ${selected.length} $type',
                          style: UITextStyle.medium.copyWith(
                            fontSize: 16,
                            color: UIColors.accentBlack,
                          ),
                        )
                      : Text(
                          'Chọn $type',
                          style: UITextStyle.medium.copyWith(
                            fontSize: 16,
                            color: UIColors.gray,
                          ),
                        ),
                ),
                const AppImage.asset(
                  asset: 'ic_dropdown',
                  height: 24,
                  width: 24,
                ),
              ],
            ),
          ),
        ),
        Padding(
          padding: const EdgeInsets.only(top: 8),
          child: selected.isNotEmpty
              ? Wrap(
                  runSpacing: 8,
                  spacing: 8,
                  children: selected
                      .map((e) => ItemSelected(
                            report: e.report,
                            onRemove: () {
                              DialogProvider.instance.showMTradeDialog(
                                context: context,
                                asset: 'ic_wait',
                                message: 'Bạn có muốn bỏ khai báo $type “${e.report.title}” ra khỏi báo cáo này?',
                                title: 'Xác nhận bỏ khai báo $type',
                                positiveCallback: () {
                                  onRemove.call(e.report.id);
                                },
                                positiveTitle: 'Bỏ $type',
                                negativeTitle: 'Quay lại',
                                titleColor: UIColors.accentOrange,
                                borderRadius: 24,
                              );
                            },
                          ))
                      .toList(),
                )
              : Row(
                  mainAxisSize: MainAxisSize.min,
                  children: [
                    const AppImage.asset(
                      asset: 'ic_warning_outline',
                      width: 18,
                      height: 18,
                    ),
                    const SizedBox(width: 4),
                    Text(
                      'Vui lòng chọn ít nhất 1 $type',
                      style: UITextStyle.regular.copyWith(
                        fontSize: 13,
                        color: UIColors.accentRed,
                      ),
                    )
                  ],
                ),
        ),
      ],
    );
  }
}

class ItemSelected extends StatelessWidget {
  const ItemSelected({
    super.key,
    required this.report,
    required this.onRemove,
  });

  final ReportModel report;
  final VoidCallback onRemove;

  @override
  Widget build(BuildContext context) {
    return Container(
      decoration: BoxDecoration(
        color: UIColors.white,
        borderRadius: BorderRadius.circular(32),
      ),
      padding: const EdgeInsets.symmetric(horizontal: 12, vertical: 7),
      child: Row(
        mainAxisSize: MainAxisSize.min,
        children: [
          Text(
            report.title,
            style: UITextStyle.regular.copyWith(
              fontSize: 13,
              color: UIColors.accentBlack,
            ),
          ),
          const SizedBox(width: 5),
          AppSplashButton(
            onTap: onRemove,
            child: const AppImage.asset(
              asset: 'ic_close',
              height: 16,
              width: 16,
            ),
          ),
        ],
      ),
    );
  }
}
