import 'package:auto_route/auto_route.dart';
import 'package:carousel_slider/carousel_slider.dart';
import 'package:flutter/material.dart';
import 'package:flutter_module/common/widgets/buttons.dart';
import 'package:flutter_module/common/widgets/images.dart';
import 'package:flutter_module/features/home/pages/home/widgets/home_block_widget.dart';
import 'package:flutter_module/models/news/contests_model.dart';
import 'package:flutter_module/routes/routes.gr.dart';

import '../../../../../common/widgets/carousel_indicator.dart';

class CompetitionProgramComponent extends StatefulWidget {
  const CompetitionProgramComponent({
    super.key,
    required this.alias,
    required this.data,
    required this.onSizeChanged,
  });

  final String alias;
  final List<ContestItemModel> data;
  final Function(String, Size) onSizeChanged;


  @override
  State<CompetitionProgramComponent> createState() => _CompetitionProgramComponentState();
}

class _CompetitionProgramComponentState extends State<CompetitionProgramComponent> {
  int currentImageIndex = 0;

  @override
  Widget build(BuildContext context) {
    final data = widget.data.map((e) => e.items ?? []).expand((e) => e).toList();
    final hasMoreBanners = data.length > 1;
    return HomeBlockWidget(
      showEmptySizedBox: data.isEmpty,
      onSizeChanged: widget.onSizeChanged,
      alias: widget.alias,
      title: "Chương trình thi đua",
      subtitle: "Tất cả",
      child: SizedBox(
        height: 200,
        child: Stack(
          fit: StackFit.expand,
          children: [
            CarouselSlider.builder(
              options: CarouselOptions(
                height: 200,
                initialPage: 0,
                viewportFraction: 1,
                scrollDirection: Axis.horizontal,
                autoPlay: hasMoreBanners,
                pageSnapping: true,
                enableInfiniteScroll: hasMoreBanners,
                autoPlayAnimationDuration: const Duration(milliseconds: 800),
                autoPlayCurve: Curves.fastOutSlowIn,
                enlargeCenterPage: true,
                onPageChanged: (index, reason) {
                  setState(() {
                    currentImageIndex = index;
                  });
                },
              ),
              itemCount: data.length,
              itemBuilder: (context, index, realIndex) {
                final item = data[index];
                return Padding(
                  padding: const EdgeInsets.symmetric(horizontal: 16),
                  child: SplashButton(
                    onTap: () {
                      context.router.push(
                        WebViewRoute(
                          title: item.urlTitle,
                          url: item.url,
                        ),
                      );
                    },
                    child: AppImage.network(
                      url: item.img,
                      height: 200,
                      width: double.infinity,
                      fit: BoxFit.fill,
                      borderRadius: BorderRadius.circular(16),
                    ),
                  ),
                );
              },
            ),
            if (hasMoreBanners)
              Align(
                alignment: Alignment.bottomCenter,
                child: CarouselIndicator(
                  length: widget.data.length,
                  currentIndex: currentImageIndex,
                ),
              ),
          ],
        ),
      ),
    );
  }
}
