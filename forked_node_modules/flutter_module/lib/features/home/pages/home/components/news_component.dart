import 'package:auto_route/auto_route.dart';
import 'package:flutter/material.dart';
import 'package:flutter_module/common/colors.dart';
import 'package:flutter_module/common/styles.dart';
import 'package:flutter_module/common/widgets/buttons.dart';
import 'package:flutter_module/features/home/pages/home/widgets/home_block_widget.dart';
import 'package:flutter_module/models/news/news_model.dart';
import 'package:flutter_module/routes/routes.gr.dart';

import '../../../../../common/widgets/images.dart';

class NewsComponent extends StatelessWidget {
  const NewsComponent({
    super.key,
    required this.alias,
    required this.data,
    required this.onSizeChanged,
  });

  final String alias;
  final List<NewsModel> data;
  final Function(String, Size) onSizeChanged;

  @override
  Widget build(BuildContext context) {
    return HomeBlockWidget(
      showEmptySizedBox: data.isEmpty,
      onSizeChanged: onSizeChanged,
      alias: alias,
      title: "Tin tức, khuyến mãi",
      subtitle: "Tất cả",
      onTapSubTitle: () {
        context.router.push(NewsRoute(focusedTabIndex: '1'));
      },
      child: SizedBox(
        height: 150,
        child: ListView.separated(
          scrollDirection: Axis.horizontal,
          padding: const EdgeInsets.symmetric(horizontal: 16),
          itemBuilder: (context, index) {
            final item = data[index];
            return SizedBox(
              width: 150,
              child: Stack(
                children: [
                  Column(
                    children: [
                      SplashButton(
                        onTap: () {
                          context.router.push(WebViewRoute(
                            title: item.postTitle ?? "",
                            url: item.webURL ?? "",
                          ));
                        },
                        child: AppImage.network(
                          url: item.postImage ?? "",
                          height: 90,
                          width: 150,
                          fit: BoxFit.fill,
                          borderRadius: BorderRadius.circular(10),
                        ),
                      ),
                      const SizedBox(
                        height: 12,
                      ),
                      Text(
                        item.postTitle ?? "",
                        style: UITextStyle.regular.copyWith(
                          fontSize: 13,
                          height: 1.2,
                          color: UIColors.grayText,
                        ),
                        maxLines: 2,
                        overflow: TextOverflow.ellipsis,
                      ),
                    ],
                  ),
                  ClipPath(
                    clipper: NewTicketClipper(),
                    child: Container(
                      padding: const EdgeInsets.only(right: 2),
                      decoration: const BoxDecoration(
                        color: UIColors.white,
                      ),
                      child: ClipPath(
                        clipper: NewTicketClipper(),
                        child: Container(
                          width: 45,
                          height: 25,
                          alignment: Alignment.center,
                          padding: const EdgeInsets.only(right: 5),
                          decoration: const BoxDecoration(
                            color: UIColors.accentGreen,
                          ),
                          child: Text(
                            'New',
                            style: UITextStyle.bold.copyWith(
                              height: 1,
                              fontSize: 12,
                              color: UIColors.white,
                            ),
                          ),
                        ),
                      ),
                    ),
                  ),
                ],
              ),
            );
          },
          itemCount: data.length,
          separatorBuilder: (_, __) => const SizedBox(
            width: 12,
          ),
        ),
      ),
    );
  }
}

class NewTicketClipper extends CustomClipper<Path> {
  @override
  Path getClip(Size size) {
    double w = size.width;
    double h = size.height;
    double gap = 8.0;

    final path = Path()
      ..lineTo(w, 0)
      ..lineTo(w - gap, h / 2)
      ..lineTo(w, h)
      ..lineTo(0, h)
      ..lineTo(0, 0);
    return path;
  }

  @override
  bool shouldReclip(NewTicketClipper oldClipper) => false;
}
