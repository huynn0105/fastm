import 'package:flutter/material.dart';
import 'package:flutter/services.dart';
import 'package:flutter_module/common/widgets/collect_data_view.dart';

import '../../../../../common/colors.dart';
import '../../../../../common/styles.dart';
import '../../../../../common/widgets/textfields.dart';

class VerifyPasswordComponent extends StatefulWidget {
  const VerifyPasswordComponent({
    super.key,
    required this.description,
    this.errMsg,
    this.onComplete,
  });

  final String description;
  final String? errMsg;
  final Function(String)? onComplete;

  @override
  State<StatefulWidget> createState() {
    return _VerifyPasswordComponent();
  }
}

class _VerifyPasswordComponent extends State<VerifyPasswordComponent> {
  late final TextEditingController passwordController;
  final FocusNode _focusNode = FocusNode();
  String? errMsg;

  @override
  void initState() {
    errMsg = widget.errMsg;
    passwordController = TextEditingController();
    _focusNode.addListener(() {
      if (!_focusNode.hasFocus) {
        FocusScope.of(context).requestFocus(_focusNode);
      }
    });
    super.initState();
  }

  @override
  void dispose() {
    passwordController.dispose();
    super.dispose();
  }

  @override
  Widget build(BuildContext context) {
    return Column(
      mainAxisSize: MainAxisSize.min,
      children: [
        const SizedBox(
          height: 16,
        ),
        Padding(
          padding: const EdgeInsets.symmetric(horizontal: 24),
          child: Text(
            widget.description,
            textAlign: TextAlign.center,
            style: UITextStyle.regular,
          ),
        ),
        const SizedBox(
          height: 16,
        ),
        Padding(
          padding: const EdgeInsets.symmetric(horizontal: 24),
          child: CollectDataView(
            errorAlignment: MainAxisAlignment.center,
            errorMsg: errMsg,
            child: UITextFieldOutline(
              controller: passwordController,
              focusNode: _focusNode,
              autofocus: true,
              obscureText: true,
              borderRadius: 27,
              hintText: 'Nhập mật khẩu',
              textAlign: TextAlign.center,
              textStyle: UITextStyle.semiBold.copyWith(
                fontSize: 16,
              ),
              hintTextStyle: UITextStyle.semiBold.copyWith(
                fontSize: 16,
                color: UIColors.gray,
              ),
              contentPadding: const EdgeInsets.only(left: 48, top: 14, bottom: 14),
              inputFormatter: [
                FilteringTextInputFormatter.digitsOnly,
                LengthLimitingTextInputFormatter(6),
              ],
              keyboardType: TextInputType.number,
              onChanged: (value) {
                if (errMsg != null) {
                  setState(() {
                    errMsg = null;
                  });
                }
                if (value.length == 6) {
                  widget.onComplete?.call(value);
                  Navigator.pop(context);
                }
              },
            ),
          ),
        ),
        const SizedBox(height: 100),
        // if (widget.showSubmitButton)
        //   PrimaryButton(
        //     enabled: passwordController.text.length == 6,
        //     onPressed: () {
        //       widget.onComplete?.call(passwordController.text);
        //       Navigator.pop(context);
        //     },
        //     title: 'Tiếp tục',
        //   )
      ],
    );
  }
}
