import 'package:flutter/material.dart';
import 'package:flutter_module/common/enum/mtrade/payment_type.dart';
import 'package:flutter_module/common/utils/format_util.dart';

import '../../../../../common/colors.dart';
import '../../../../../common/enum/shipper/payment_status.dart';
import '../../../../../common/styles.dart';
import '../../../../../common/widgets/images.dart';
import '../../../../../models/shipper/order/shipper_detail_order_model.dart';
import '../widgets/information_widget.dart';
import '../widgets/product_widget.dart';

class OrderItem extends StatelessWidget {
  const OrderItem({Key? key, this.data}) : super(key: key);
  final DeliveryModel? data;

  @override
  Widget build(BuildContext context) {
    final isPaid = data?.orderDetail?.masterPaymentsStatus?.code == PaymentStatus.PAID.name;
    final orderTotal = data?.orderDetail?.omsOrderItems
        ?.map((e) => (e.price ?? 0) * (e.quantity ?? 0))
        .fold(0, (pre, cur) => pre + cur);
    final prepaymentAmount = data?.orderDetail?.prepaymentAmount;
    final paymentAmount = isPaid
        ? 0
        : data?.orderDetail?.paymentMethod?.code == MTradePaymentType.later.code
            ? prepaymentAmount
            : orderTotal;
    return Column(
      children: [
        Row(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            const AppImage.asset(
              asset: "ic_mtrade_cart",
              width: 20,
              height: 20,
            ),
            const SizedBox(
              width: 8,
            ),
            Expanded(
              child: Wrap(
                alignment: WrapAlignment.spaceBetween,
                spacing: 5,
                children: [
                  Text(
                    "ĐƠN HÀNG",
                    style: UITextStyle.regular.copyWith(
                      fontSize: 14,
                      color: UIColors.grayText,
                    ),
                  ),
                  Text(
                    "Mã vận đơn: ${data?.orderDetail?.orderDeliveryCode ?? ''}",
                    style: UITextStyle.semiBold.copyWith(
                      fontSize: 14,
                      color: UIColors.secondaryColor,
                    ),
                  ),
                ],
              ),
            ),
          ],
        ),
        const SizedBox(
          height: 4,
        ),
        Padding(
          padding: const EdgeInsets.only(left: 28),
          child: Column(
            children: [
              InformationWidget(
                title: "Mã đơn hàng:",
                content: data?.orderDetail?.code ?? '',
              ),
              InformationWidget(
                title: "Hàng có giá trị:",
                content: data?.orderDetail?.getRiskLevel()?.name ?? '',
                highlight: true,
                contentColor: _getColor(),
              ),
              InformationWidget(
                title: "Tổng số tiền cần thu",
                content: FormatUtil.currencyFormat(paymentAmount),
                highlight: true,
                contentColor: UIColors.red,
              ),
              InformationWidget(
                title: "Lưu ý:",
                content: data?.orderDetail?.note ?? "---",
              ),
              ProductWidget(
                data: data,
              ),
            ],
          ),
        ),
      ],
    );
  }

  _getColor() {
    String code = data?.orderDetail?.getRiskLevel()?.code ?? '';
    if (code == "HIGH") {
      return UIColors.red;
    }
    if (code == "MEDIUM") {
      return UIColors.darkBlue;
    }
    return UIColors.lightPurple;
  }
}
