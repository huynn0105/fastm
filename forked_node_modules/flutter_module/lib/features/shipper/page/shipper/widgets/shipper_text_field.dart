import 'package:flutter/material.dart';

import '../../../../../common/colors.dart';
import '../../../../../common/styles.dart';
import '../../../../../common/widgets/buttons.dart';
import '../../../../../common/widgets/images.dart';

class ShipperSearchTextField extends StatefulWidget {
  const ShipperSearchTextField({
    Key? key,
    this.controller,
    this.hintText,
    this.onChanged,
    this.onSubmitted,
    this.onCleared,
    this.onTap,
    this.autoFocus = false,
    this.autoClear = true,
    this.readOnly = false,
    this.textAlign = TextAlign.start,
  }) : super(key: key);

  final TextEditingController? controller;
  final bool autoFocus;
  final bool autoClear;
  final String? hintText;
  final Function(String)? onChanged;
  final Function(String)? onSubmitted;
  final VoidCallback? onCleared;
  final VoidCallback? onTap;
  final TextAlign textAlign;
  final bool readOnly;

  @override
  State<ShipperSearchTextField> createState() => _ShipperSearchTextFieldState();
}

class _ShipperSearchTextFieldState extends State<ShipperSearchTextField> {
  late final TextEditingController _controller;

  @override
  void initState() {
    super.initState();
    _controller = widget.controller ?? TextEditingController();
  }

  @override
  void dispose() {
    _controller.dispose();
    super.dispose();
  }

  @override
  Widget build(BuildContext context) {
    return SizedBox(
      height: 40,
      child: TextField(
        controller: _controller,
        readOnly: widget.readOnly,
        autofocus: widget.autoFocus,
        cursorWidth: 2,
        cursorHeight: 25,
        cursorColor: UIColors.primaryColor,
        cursorRadius: const Radius.circular(1),
        style: UITextStyle.medium.copyWith(
          fontSize: 16,
        ),
        onTap: widget.onTap,
        onChanged: widget.onChanged,
        onSubmitted: widget.onSubmitted,
        textAlign: widget.textAlign,
        decoration: InputDecoration(
          filled: true,
          fillColor: UIColors.white,
          hintText: widget.hintText,
          hintStyle: UITextStyle.regular.copyWith(
            fontSize: 14,
            height: 1.5,
            color: UIColors.grayText,
          ),
          enabledBorder: OutlineInputBorder(
            borderRadius: BorderRadius.circular(25),
            borderSide: const BorderSide(
              color: UIColors.white,
            ),
          ),
          focusedBorder: OutlineInputBorder(
            borderRadius: BorderRadius.circular(25),
            borderSide: BorderSide(
              color: widget.readOnly ? UIColors.white : UIColors.primaryColor,
            ),
          ),
          contentPadding: const EdgeInsets.symmetric(
            vertical: 8,
          ),
          prefixIconConstraints: const BoxConstraints(
            maxWidth: 40,
            maxHeight: 40,
          ),
          prefixIcon: const SizedBox(
            width: 40,
            height: 40,
            child: Center(
              child: AppImage.asset(
                asset: "ic_search_outline",
                width: 24,
                height: 24,
                color: UIColors.grayText,
              ),
            ),
          ),
          suffixIconConstraints: const BoxConstraints(
            maxWidth: 40,
            maxHeight: 40,
          ),
          suffixIcon: ValueListenableBuilder(
            valueListenable: _controller,
            builder: (context, value, child) {
              return value.text.isEmpty
                  ? const SizedBox(
                      width: 40,
                      height: 40,
                    )
                  : AppSplashButton(
                      onTap: () {
                        if (widget.autoClear) {
                          _controller.clear();
                        }
                        widget.onCleared?.call();
                      },
                      borderRadius: BorderRadius.circular(24),
                      child: const SizedBox(
                        width: 40,
                        height: 40,
                        child: Center(
                          child: AppImage.asset(
                            asset: "ic_mtrade_clear_x",
                            width: 24,
                            height: 24,
                          ),
                        ),
                      ),
                    );
            },
          ),
        ),
      ),
    );
  }
}
