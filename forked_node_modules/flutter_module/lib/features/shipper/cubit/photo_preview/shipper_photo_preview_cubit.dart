import 'dart:math';

import 'package:bloc/bloc.dart';
import 'package:card_swiper/card_swiper.dart';
import 'package:equatable/equatable.dart';
import '../../../../models/shipper/document/photo_preview_model.dart';

part 'shipper_photo_preview_state.dart';

class ShipperPhotoPreviewCubit extends Cubit<ShipperPhotoPreviewState> {
  ShipperPhotoPreviewCubit() : super(const ShipperPhotoPreviewState());

  final SwiperController swiperController = SwiperController();

  fetchData(List<PhotoPreviewModel> photos, String selectedPhoto) {
    emit(state.copyWith(
      photos: photos,
    ));
    changeIndex(max(0, photos.indexWhere((e) => e.url == selectedPhoto)));
  }

  changeIndex(int index) {
    emit(state.copyWith(
      currentIndex: index,
      enabledNext: index < state.photos.length - 1,
      enabledPrevious: index > 0,
    ));
  }

  next() {
    if (state.currentIndex < state.photos.length - 1) {
      swiperController.next();
      changeIndex(state.currentIndex + 1);
    }
  }

  previous() {
    if (state.currentIndex > 0) {
      swiperController.previous();
      changeIndex(state.currentIndex - 1);
    }
  }

  @override
  Future<void> close() {
    swiperController.dispose();
    return super.close();
  }
}
