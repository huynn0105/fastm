import 'package:auto_route/auto_route.dart';
import 'package:flutter/material.dart';
import 'package:flutter_bloc/flutter_bloc.dart';
import 'package:flutter_module/common/widgets/tabbar/tabbar.dart';
import 'package:flutter_module/features/client/cubit/client/client_cubit.dart';

import '../../../../../common/constants.dart';
import '../../../../../routes/routes.gr.dart';

class TabbarComponent extends StatefulWidget {
  const TabbarComponent({Key? key}) : super(key: key);

  @override
  State<TabbarComponent> createState() => _TabbarComponentState();
}

class _TabbarComponentState extends State<TabbarComponent> {
  TabController? _tabController;

  @override
  Widget build(BuildContext context) {
    return AutoTabsRouter.tabBar(
      physics: AppConstants.physics,
      routes: const [
        ClientStatisticRoute(),
        ClientListRoute(),
      ],
      builder: (context, child, tabController) {
        _tabController = tabController;
        return BlocListener<ClientGlobalCubit, ClientState>(
          listenWhen: (previous, current) => previous.filterSelected != current.filterSelected,
          listener: (context, state) {
            _tabController?.animateTo(1);
          },
          child: Column(
            mainAxisSize: MainAxisSize.min,
            children: [
              RoundedIndicatorTabbar(
                controller: tabController,
                margin: const EdgeInsets.symmetric(
                  horizontal: 63,
                ),
                titles: const [
                  "Thống kê",
                  "Danh sách",
                ],
              ),
              const SizedBox(
                height: 16,
              ),
              Expanded(
                child: child,
              ),
            ],
          ),
        );
      },
    );
  }
}
