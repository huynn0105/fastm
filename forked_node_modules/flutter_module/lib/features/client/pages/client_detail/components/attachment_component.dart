import 'package:flutter/foundation.dart';
import 'package:flutter/material.dart';
import 'package:flutter_module/common/colors.dart';
import 'package:flutter_module/common/extension/list_extension.dart';
import 'package:flutter_module/common/styles.dart';
import 'package:flutter_module/common/widgets/buttons.dart';
import 'package:flutter_module/common/widgets/images.dart';
import 'package:flutter_module/features/client/pages/client_detail/components/preview_images_component.dart';
import 'package:flutter_module/models/client/client_detail/client_document_model.dart';

import '../items/attachment_list_item.dart';

class AttachmentComponent extends StatelessWidget {
  const AttachmentComponent({
    Key? key,
    required this.data,
  }) : super(key: key);

  final List<ClientDocumentModel> data;

  @override
  Widget build(BuildContext context) {
    List<String> images = data.map((e) => e.image ?? []).expand((e) => e).toList();
    return Column(
      mainAxisSize: MainAxisSize.min,
      children: [
        const SizedBox(
          height: 8,
        ),
        Row(
          children: [
            Expanded(
              child: Text(
                "Hình ảnh hồ sơ đi kèm",
                style: UITextStyle.regular.copyWith(
                  color: UIColors.grayText,
                ),
              ),
            ),
            AppSplashButton(
              onTap: () {
                _onOpenBottomSheet(context);
              },
              child: Row(
                mainAxisSize: MainAxisSize.min,
                children: [
                  Text(
                    images.length.toString(),
                    style: UITextStyle.regular.copyWith(
                      color: UIColors.grayText,
                    ),
                  ),
                  const SizedBox(
                    width: 5,
                  ),
                  const AppImage.asset(
                    asset: "ic_arrow_right",
                    width: 20,
                    height: 20,
                    color: UIColors.grayText,
                  ),
                ],
              ),
            ),
          ],
        ),
        const SizedBox(
          height: 8,
        ),
        AttachmentListItem(
          data: images,
          onShowMore: ({url}) => _onOpenBottomSheet(context, url: url),
        ),
      ],
    );
  }

  _onOpenBottomSheet(BuildContext context, {String? url}) {
    showModalBottomSheet(
      context: context,
      isScrollControlled: true,
      isDismissible: true,
      enableDrag: true,
      backgroundColor: Colors.transparent,
      barrierColor: UIColors.blurBackground,
      builder: (_) {
        return PreviewImagesComponent(data: data, url: url);
      },
    );
  }
}
