import 'package:flutter/material.dart';
import 'package:flutter_module/common/global_function.dart';
import 'package:flutter_module/features/client/pages/client_detail/widgets/priority_button.dart';
import 'package:flutter_module/features/client/pages/client_detail/widgets/sale_action_tag.dart';

import '../../../../../../../common/colors.dart';
import '../../../../../../../common/styles.dart';
import '../../../../../../../common/utils/format_util.dart';
import '../../../../../../../common/widgets/avatar_widget.dart';
import '../../../../../../../common/widgets/buttons.dart';
import '../../../../../../../common/widgets/images.dart';
import '../widgets/info_item.dart';
import 'dart:math' as math;

class InfoComponent extends StatelessWidget {
  const InfoComponent({
    Key? key,
    required this.avatar,
    required this.fullName,
    required this.idNumber,
    required this.mobilePhone,
    required this.address,
    required this.isPriority,
    required this.gender,
    this.onInfoEditTap,
    this.onAvatarEditTap,
    this.onPriorityTap,
    this.showInfoEditButton = true,
    this.showPriorityButton = true,
    this.showMyClientTag = false,
    this.showPriorityTag = false,
    this.showTrashTag = false,
  }) : super(key: key);

  final String avatar;
  final String fullName;
  final String idNumber;
  final String mobilePhone;
  final String address;
  final bool isPriority;
  final String gender;

  ///
  final Function()? onInfoEditTap;
  final Function()? onAvatarEditTap;
  final Function(bool)? onPriorityTap;
  final bool showInfoEditButton;
  final bool showPriorityButton;
  final bool showMyClientTag;
  final bool showPriorityTag;
  final bool showTrashTag;

  @override
  Widget build(BuildContext context) {
    return Column(
      mainAxisSize: MainAxisSize.min,
      children: [
        const SizedBox(
          height: 16,
        ),
        Stack(
          alignment: AlignmentDirectional.topCenter,
          children: [
            Column(
              children: [
                Stack(
                  clipBehavior: Clip.none,
                  children: [
                    Align(
                      alignment: Alignment.topCenter,
                      child: AvatarWidget.edit(
                        url: avatar,
                        size: 80,
                        onEditTap: onAvatarEditTap,
                        errorBuilder: () {
                          return AppImage.asset(
                            asset: 'ic_avatar_default_male',
                            width: 80,
                            height: 80,
                            borderRadius: BorderRadius.circular(40),
                          );
                        },
                      ),
                    ),
                    Visibility(
                      visible: showMyClientTag,
                      child: Positioned(
                        top: 0,
                        left: -16,
                        child: Container(
                          width: 70,
                          height: 30,
                          alignment: Alignment.center,
                          decoration: const BoxDecoration(
                            color: UIColors.lightBlue,
                          ),
                          child: Text(
                            'Của tôi',
                            style: UITextStyle.semiBold.copyWith(
                              fontSize: 12,
                              color: UIColors.darkBlue,
                            ),
                          ),
                        ),
                      ),
                    ),
                    Visibility(
                      visible: showPriorityButton,
                      child: Positioned(
                        top: 0,
                        right: 0,
                        child: PriorityButton(
                          showTitle: true,
                          isPriority: isPriority,
                          onToggle: onPriorityTap,
                        ),
                      ),
                    ),
                  ],
                ),
                const SizedBox(
                  height: 12,
                ),
                Row(
                  mainAxisAlignment: MainAxisAlignment.spaceBetween,
                  children: [
                    Visibility(
                      visible: showInfoEditButton,
                      child: const SizedBox(
                        width: 24,
                        height: 24,
                      ),
                    ),
                    Expanded(
                      child: Text(
                        fullName,
                        style: UITextStyle.semiBold.copyWith(
                          fontSize: 18,
                          color: UIColors.darkBlue,
                        ),
                        maxLines: 1,
                        textAlign: TextAlign.center,
                      ),
                    ),
                    Visibility(
                      visible: showInfoEditButton,
                      child: SplashButton(
                        onTap: onInfoEditTap,
                        child: const AppImage.asset(
                          asset: "ic_edit",
                          width: 24,
                          height: 24,
                        ),
                      ),
                    ),
                  ],
                ),
              ],
            ),
            Positioned(
              top: 35,
              left: 0,
              child: AnimatedOpacity(
                opacity: showPriorityTag ? 1 : 0,
                duration: const Duration(milliseconds: 250),
                child: Transform.rotate(
                  angle: -math.pi / 4,
                  child: const SaleActionTag.priority(),
                ),
              ),
            ),
            Positioned(
              top: 25,
              right: 20,
              child: AnimatedOpacity(
                opacity: showTrashTag ? 1 : 0,
                duration: const Duration(milliseconds: 250),
                child: Transform.rotate(
                  angle: math.pi / 4,
                  child: const SaleActionTag.trash(),
                ),
              ),
            ),
          ],
        ),
        const SizedBox(
          height: 8,
        ),
        Row(
          children: [
            Expanded(
              child: InfoItem(
                title: idNumber,
                asset: "ic_cccd_outline",
              ),
            ),
            Expanded(
              child: SplashButton(
                onTap: () {
                  GlobalFunction.launchPhone(mobilePhone);
                },
                child: InfoItem.primary(
                  title: FormatUtil.phoneFormat(mobilePhone),
                  asset: "ic_call_ringing_outline",
                ),
              ),
            ),
          ],
        ),
        const SizedBox(
          height: 8,
        ),
        InfoItem(
          title: address,
          asset: "ic_location_outline",
        ),
      ],
    );
  }
}
