import 'package:flutter/material.dart';
import 'package:flutter_bloc/flutter_bloc.dart';
import 'package:flutter_module/common/bloc_status.dart';
import 'package:flutter_module/common/enum/client/project_detail_type.dart';
import 'package:flutter_module/common/size.dart';
import 'package:flutter_module/common/widgets/loading.dart';
import 'package:flutter_module/features/client/cubit/detail_project/detail_project_cubit.dart';
import 'package:flutter_module/features/client/pages/client_detail/items/daa_project_detail_item.dart';
import 'package:flutter_module/features/client/pages/client_detail/items/finance_project_detail_item.dart';
import 'package:flutter_module/features/client/pages/client_detail/items/insurance_project_detail_item.dart';
import 'package:flutter_module/features/client/pages/client_detail/items/mpl_project_detail_item.dart';
import 'package:flutter_module/models/client/client_detail/client_project_model.dart';

class DetailProjectComponent extends StatelessWidget {
  const DetailProjectComponent({
    super.key,
    required this.item,
  });

  final ClientProjectModel item;

  @override
  Widget build(BuildContext context) {
    return BlocProvider(
      create: (context) {
        final cubit = DetailProjectCubit();
        cubit.initCubit(item);
        return cubit;
      },
      child: BlocBuilder<DetailProjectCubit, DetailProjectState>(
        builder: (context, state) {
          if (state.status.isInitial) {
            WidgetsBinding.instance.addPostFrameCallback((_) {
              final cubit = context.read<DetailProjectCubit>();
              cubit.getDetailProject();
            });
          }

          return AnimatedContainer(
            constraints: state.status.showLoading
                ? const BoxConstraints(
                    maxHeight: 150,
                  )
                : BoxConstraints(
                    maxHeight: AppSize.instance.height,
                  ),
            duration: const Duration(
              milliseconds: 200,
            ),
            child: state.status.showLoading
                ? const SizedBox(
                    height: 150,
                    child: LoadingWidget.withoutText(),
                  )
                : item.category == ProjectDetailType.pl.name
                    ? FinanceProjectDetailItem(
                        item: state.data?.finance,
                        initItem: item,
                      )
                    : item.category == ProjectDetailType.insurance.name
                        ? InsuranceProjectDetailItem(
                            item: state.data?.insurance,
                            initItem: item,
                          )
                        : item.category == ProjectDetailType.daa.name
                            ? DAAProjectDetailItem(
                                item: state.data?.daa,
                                initItem: item,
                              )
                            : item.category == ProjectDetailType.mpl.name
                                ? MPLProjectDetailItem(
                                    item: state.data?.mpl,
                                    initItem: item,
                                  )
                                : SizedBox(),
          );
        },
      ),
    );
  }
}
