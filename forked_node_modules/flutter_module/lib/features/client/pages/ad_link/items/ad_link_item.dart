import 'package:auto_route/auto_route.dart';
import 'package:flutter/material.dart';
import 'package:flutter_bloc/flutter_bloc.dart';
import 'package:flutter_module/common/colors.dart';
import 'package:flutter_module/common/enum/client/ad_link_tab_type.dart';
import 'package:flutter_module/common/styles.dart';
import 'package:flutter_module/common/utils/text_util.dart';
import 'package:flutter_module/common/widgets/buttons.dart';
import 'package:flutter_module/common/widgets/images.dart';
import 'package:flutter_module/features/client/cubit/ad_link_list/ad_link_list_cubit.dart';
import 'package:flutter_module/models/client/ad_link/ad_link_model.dart';
import 'package:flutter_module/routes/routes.gr.dart';

class AdLinkItem extends StatelessWidget {
  const AdLinkItem({
    super.key,
    required this.item,
    this.onShare,
    this.onBrochure,
  });
  final AdLinkModel item;
  final VoidCallback? onShare;
  final VoidCallback? onBrochure;

  @override
  Widget build(BuildContext context) {
    final disabled = item.active != '1';
    return AppSplashButton(
      onTap: () {
        context
            .pushRoute(MTradePersonalLinkSetupRoute(
          item: item,
        ))
            .then((value) {
          if (value == true) {
            final cubit = context.read<AdLinkListCubit>();
            cubit.getListAdLink();
          }
        });
      },
      child: Container(
        margin: const EdgeInsets.only(top: 12),
        padding: const EdgeInsets.symmetric(
          horizontal: 12,
          vertical: 10,
        ),
        decoration: BoxDecoration(
          borderRadius: BorderRadius.circular(8),
          color: disabled ? UIColors.lightGray : UIColors.white,
        ),
        child: Row(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            AppImage.network(
              url: item.icon ?? "",
              width: 32,
              height: 32,
            ),
            const SizedBox(
              width: 12,
            ),
            Expanded(
              child: Column(
                children: [
                  Row(
                    children: [
                      Expanded(
                        child: Text(
                          item.title ?? "",
                          style: UITextStyle.semiBold.copyWith(
                            fontSize: 16,
                            color: UIColors.primaryColor,
                          ),
                          maxLines: 1,
                          overflow: TextOverflow.ellipsis,
                        ),
                      ),
                      SplashButton(
                        isDisabled: disabled,
                        onTap: onBrochure,
                        child: AppImage.asset(
                          asset: 'ic_mtrade_brochure',
                          width: 20,
                          height: 20,
                          color: disabled ? UIColors.gray : UIColors.primaryColor,
                        ),
                      ),
                      const SizedBox(
                        width: 20,
                      ),
                      SplashButton(
                        isDisabled: disabled,
                        onTap: onShare,
                        child: AppImage.asset(
                          asset: 'ic_mtrade_send_outline',
                          width: 20,
                          height: 20,
                          color: disabled ? UIColors.gray : UIColors.primaryColor,
                        ),
                      ),
                    ],
                  ),
                  Row(
                    children: [
                      _renderAmount(
                        title: "Quan tâm",
                        color: UIColors.violet,
                        amount: TextUtils.parseInt(item.totalFollow) ?? 0,
                      ),
                      const SizedBox(
                        width: 24,
                      ),
                      _renderAmount(
                        title: "Tham gia",
                        color: UIColors.orange,
                        amount: TextUtils.parseInt(item.totalAttended) ?? 0,
                      ),
                      const SizedBox(
                        width: 24,
                      ),
                      _renderAmount(
                        title: "Thành công",
                        color: UIColors.green,
                        amount: TextUtils.parseInt(item.totalSuccess) ?? 0,
                      ),
                    ],
                  ),
                ],
              ),
            )
          ],
        ),
      ),
    );
  }

  Widget _renderAmount({
    String title = "",
    int amount = 0,
    Color? color,
  }) {
    return Column(
      crossAxisAlignment: CrossAxisAlignment.start,
      children: [
        Text(
          title,
          style: UITextStyle.regular.copyWith(
            fontSize: 13,
            color: UIColors.grayText,
          ),
        ),
        Row(
          children: [
            Text(
              amount.toString(),
              style: UITextStyle.semiBold.copyWith(
                color: color,
              ),
            ),
            if (amount > 0) ...[
              const SizedBox(
                width: 4,
              ),
              AppImage.asset(
                asset: "ic_arrow_right",
                width: 16,
                height: 16,
                color: color,
              ),
            ],
          ],
        )
      ],
    );
  }
}
