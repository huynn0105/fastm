import 'package:auto_route/auto_route.dart';
import 'package:flutter/material.dart';
import 'package:flutter_bloc/flutter_bloc.dart';
import 'package:flutter_module/common/bottom_sheet/bottom_sheet_provider.dart';
import 'package:flutter_module/common/colors.dart';
import 'package:flutter_module/common/global_function.dart';
import 'package:flutter_module/common/styles.dart';
import 'package:flutter_module/common/widgets/avatar/chat_avatar.dart';
import 'package:flutter_module/common/widgets/buttons.dart';
import 'package:flutter_module/common/widgets/images.dart';
import 'package:flutter_module/features/chat/cubit/chat_thread/chat_thread_cubit.dart';
import 'package:flutter_module/models/chat/contact/chat_contact_model.dart';
import 'package:flutter_module/routes/routes.gr.dart';

class SearchContactItem extends StatelessWidget {
  const SearchContactItem({
    super.key,
    required this.item,
    this.index,
    this.action,
  });

  final ChatContactModel item;
  final int? index;
  final Widget? action;

  @override
  Widget build(BuildContext context) {
    return ListTile(
      onTap: () {
        BottomSheetProvider.instance.showBottomSheetUserReviews(
          context,
          uid: item.uid ?? "",
          fullName: item.fullName,
          avatarImage: item.avatar,
        );
      },
      contentPadding: EdgeInsets.only(top: (index ?? 0) > 0 ? 16 : 8),
      horizontalTitleGap: 12,
      leading: ChatAvatar(
        uid: item.uid,
        url: item.avatar ?? '',
        name: item.fullName ?? '',
        size: 48,
      ),
      // trailing: Text(item.name ?? ''),
      title: Container(
        decoration: const BoxDecoration(
          border: Border(
            bottom: BorderSide(
              color: UIColors.lightGray,
            ),
          ),
        ),
        height: 48,
        child: Row(
          mainAxisAlignment: MainAxisAlignment.center,
          children: [
            Expanded(
              child: Text(
                item.fullName ?? '',
                maxLines: 1,
                overflow: TextOverflow.ellipsis,
                style: UITextStyle.medium.copyWith(
                  fontSize: 16,
                  color: UIColors.boolText,
                ),
              ),
            ),
            const SizedBox(
              width: 12,
            ),
            if (action != null) ...{
              action!
            } else ...{
              // SplashButton(
              //   onTap: () {
              //     _onCall(context);
              //   },
              //   child: const AppImage.asset(
              //     asset: 'ic_call_outline',
              //     width: 24,
              //     height: 24,
              //   ),
              // ),
              // const SizedBox(
              //   width: 16,
              // ),
              SplashButton(
                onTap: () {
                  _onChat(context);
                },
                child: const AppImage.asset(
                  asset: 'ic_message',
                  width: 24,
                  height: 24,
                ),
              ),
            },
          ],
        ),
      ),
    );
  }

  _onCall(BuildContext context) {
    GlobalFunction.launchPhone(item.phone ?? '');
  }

  _onChat(BuildContext context) {
    final thread = context.read<ChatThreadCubit>().getThreadWithUserID(userID: item.uid ?? '');

    if (thread != null) {
      context.pushRoute(ThreadMessagesRoute(thread: thread, threadID: thread.uid));
    }
  }
}
