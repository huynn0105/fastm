import 'package:auto_route/auto_route.dart';
import 'package:flutter/material.dart';
import 'package:flutter_bloc/flutter_bloc.dart';
import 'package:flutter_module/common/bottom_sheet/bottom_sheet_provider.dart';
import 'package:flutter_module/common/styles.dart';
import 'package:flutter_module/common/widgets/buttons.dart';
import 'package:flutter_module/common/widgets/images.dart';
import 'package:flutter_module/features/chat/cubit/chat_contact/chat_contact_cubit.dart';
import 'package:flutter_module/features/chat/cubit/chat_thread/chat_thread_cubit.dart';
import 'package:flutter_module/features/chat/page/chat/components/create_chat_component.dart';
import 'package:flutter_module/features/mtrade/page/mtrade/widgets/mtrade_text_field.dart';

class ChatSearchBarComponent extends StatelessWidget {
  const ChatSearchBarComponent({
    super.key,
    this.readOnly = false,
    this.autoFocus = false,
    this.showButtonClose = false,
    this.onTap,
    this.controller,
    this.onChanged,
  });

  final bool readOnly;
  final bool autoFocus;
  final bool showButtonClose;
  final Function()? onTap;
  final TextEditingController? controller;
  final Function(String)? onChanged;

  @override
  Widget build(BuildContext context) {
    return Row(
      children: [
        const SizedBox(
          width: 16,
        ),
        SplashButton(
          onTap: () {
            context.popRoute();
          },
          child: const AppImage.asset(
            asset: 'ic_arrow_left',
            width: 24,
            height: 24,
          ),
        ),
        const SizedBox(
          width: 12,
        ),
        Expanded(
          child: MTradeSearchTextField(
            readOnly: readOnly,
            autoFocus: autoFocus,
            onTap: onTap,
            hintText: 'Tìm kiếm',
            controller: controller,
            onChanged: onChanged,
          ),
        ),
        SplashButton(
          onTap: () async {
            if (showButtonClose) {
              context.popRoute();
              return;
            }

            BottomSheetProvider.instance.show(
              context,
              title: 'Khởi tạo',
              child: MultiBlocProvider(
                providers: [
                  BlocProvider.value(value: context.read<ChatContactCubit>()),
                  BlocProvider.value(value: context.read<ChatThreadCubit>()),
                ],
                child: const CreateChatComponent(),
              ),
            );
          },
          child: Padding(
            padding: const EdgeInsets.symmetric(horizontal: 16),
            child: showButtonClose
                ? Text(
                    'Đóng',
                    style: UITextStyle.regular.copyWith(),
                  )
                : const AppImage.asset(
                    asset: 'ic_mtrade_plus',
                    width: 24,
                    height: 24,
                  ),
          ),
        ),
      ],
    );
  }
}
