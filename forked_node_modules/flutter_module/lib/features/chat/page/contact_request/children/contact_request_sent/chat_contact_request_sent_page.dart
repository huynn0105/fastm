import 'package:auto_route/auto_route.dart';
import 'package:flutter/material.dart';
import 'package:flutter_bloc/flutter_bloc.dart';
import 'package:flutter_module/common/bloc_status.dart';
import 'package:flutter_module/common/widgets/empty_widget.dart';
import 'package:flutter_module/common/widgets/loading.dart';
import 'package:flutter_module/common/widgets/loadmore_widget.dart';
import 'package:flutter_module/features/chat/cubit/chat_requested_contact/chat_requested_contact_cubit.dart';
import 'package:flutter_module/features/chat/page/contact_request/components/list_requested_contacts_component.dart';

@RoutePage()
class ChatContactRequestSentPage extends StatelessWidget {
  const ChatContactRequestSentPage({super.key});

  @override
  Widget build(BuildContext context) {
    return Padding(
      padding: const EdgeInsets.only(
        left: 16,
        right: 16,
        top: 8,
      ),
      child: BlocBuilder<ChatRequestedContactCubit, ChatRequestedContactState>(
        builder: (context, state) {
          if (state.status.isLoading) {
            return const LoadingWidget.withoutText();
          }

          if (state.sentRequests.isEmpty) {
            return LoadMoreWidget(
              onRefresh: () {
                final cubit = context.read<ChatRequestedContactCubit>();
                return cubit.fetchInvitationAndSendingRequest();
              },
              child: const EmptyWidget(
                message: "Không tìm thấy yêu cầu kết bạn",
              ),
            );
          }

          return Stack(
            children: [
              ListRequestedContactsComponent(
                data: state.sentRequests,
              ),
              Visibility(
                visible: state.actionStatus.isLoading,
                child: const LoadingWidget.withoutText(),
              ),
            ],
          );
        },
      ),
    );
  }
}
