import 'package:flutter/material.dart';
import 'package:flutter_bloc/flutter_bloc.dart';
import 'package:flutter_module/common/constants.dart';
import 'package:flutter_module/features/chat/cubit/chat_add_contact/chat_add_contact_cubit.dart';
import 'package:flutter_module/features/chat/cubit/chat_contact/chat_contact_cubit.dart';
import 'package:flutter_module/features/chat/page/add_contact/items/add_contact_item.dart';
import 'package:flutter_module/models/chat/contact/chat_search_contact_model.dart';

class ListAddContactsComponent extends StatelessWidget {
  const ListAddContactsComponent({
    super.key,
    required this.data,
  });

  final List<ChatSearchContactModel> data;

  @override
  Widget build(BuildContext context) {
    return BlocBuilder<ChatContactCubit, ChatContactState>(
      builder: (context, state) {
        return Column(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            Expanded(
              child: ListView.builder(
                physics: AppConstants.physics,
                shrinkWrap: true,
                itemCount: data.length,
                itemBuilder: (context, index) {
                  final item = data[index];
                  final bool isExist =
                      state.contacts.indexWhere((e) => item.phoneNumber?.contains(e.phone ?? '') ?? false) != -1;
                  return AddContactItem(
                    item: item,
                    index: index,
                    isExist: isExist,
                    onSendAddContact: () {
                      _onSendAddContact(
                        context,
                        nickname: item.nickname,
                        phoneNumber: item.phoneNumber,
                      );
                    },
                  );
                },
              ),
            ),
          ],
        );
      },
    );
  }

  _onSendAddContact(BuildContext context, {String? phoneNumber, String? nickname}) {
    final cubit = context.read<ChatAddContactCubit>();
    cubit.sendRequestAddContact(
      nickname: nickname,
      phoneNumber: phoneNumber,
    );
  }
}
