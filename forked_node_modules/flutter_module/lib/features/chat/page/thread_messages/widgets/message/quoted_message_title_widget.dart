import 'package:flutter/material.dart';
import 'package:flutter_module/app_data.dart';
import 'package:flutter_module/common/colors.dart';
import 'package:flutter_module/common/styles.dart';
import 'package:flutter_module/models/chat/message/message_model.dart';
import 'package:flutter_module/models/chat/message/message_wrapper_model.dart';

class RepliedMessageTitleWidget extends StatelessWidget {
  const RepliedMessageTitleWidget({
    super.key,
    required this.currentMessage,
    required this.quotedMessage,
  });

  final MessageModel? currentMessage;
  final MessageModel? quotedMessage;

  @override
  Widget build(BuildContext context) {
    var title = '';

    var currentAuthor = currentMessage?.author?.fullName ?? '';
    var quotedAuthor = quotedMessage?.author?.fullName ?? '';
    var quotedIsRecalled = quotedMessage?.isRecalled == true;

    if (currentMessage?.isMe() == true) {
      String name = (quotedMessage?.isMe() == true) ? 'chính mình' : quotedAuthor;
      title = 'Bạn đã trả lời $name';
    } else {
      String name = (quotedMessage?.isMe() == true) ? 'bạn' : 'chính họ';
      title = '$currentAuthor đã trả lời $name';
    }

    if (title.isEmpty) {
      return const SizedBox();
    }
    return SizedBox(
      height: 20,
      child: Row(
        mainAxisSize: MainAxisSize.min,
        crossAxisAlignment: CrossAxisAlignment.center,
        children: [
          const Icon(
            Icons.reply_rounded,
            size: 20,
            color: UIColors.grayText,
          ),
          Flexible(
            child: Text(
              quotedIsRecalled ? '' : title,
              style: UITextStyle.regular.copyWith(
                fontSize: 13,
                color: UIColors.grayText,
              ),
              maxLines: 1,
              overflow: TextOverflow.ellipsis,
            ),
          ),
        ],
      ),
    );
  }
}

class ForwardedMessageTitleWidget extends StatelessWidget {
  const ForwardedMessageTitleWidget({
    super.key,
    required this.data,
  });

  final MessageWrapperModel data;

  @override
  Widget build(BuildContext context) {
    final isMe = data.message?.author?.id == AppData.instance.userID;
    final name = isMe ? 'Bạn' : data.message?.author?.fullName ?? '';
    final title = '$name đã chuyển tiếp tin nhắn';
    return SizedBox(
      height: 20,
      child: Row(
        mainAxisSize: MainAxisSize.min,
        crossAxisAlignment: CrossAxisAlignment.center,
        children: [
          const Icon(
            Icons.reply_rounded,
            size: 20,
            color: UIColors.grayText,
            textDirection: TextDirection.rtl,
          ),
          Flexible(
            child: Text(
              title,
              style: UITextStyle.regular.copyWith(
                fontSize: 12,
                color: UIColors.grayText,
              ),
              maxLines: 1,
              overflow: TextOverflow.ellipsis,
            ),
          ),
        ],
      ),
    );
  }
}
