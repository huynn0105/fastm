<html>
<header>
  <title>This is title</title>
</header>

<body>
  <div style='font-size:40px'>
    <div id="one">one</div>
  </div>
  <script type="text/javascript">
    var html = document.getElementById('one');

    function waitForBridge() {
      console.log(window.postMessage);
      html.insertAdjacentHTML('beforeend', `<div>postmessage 0 string ${window.postMessage}</div>`);
      html.insertAdjacentHTML('beforeend', `<div>postmessage ${window.postMessage.length}</div>`);
      html.insertAdjacentHTML('beforeend', `<div>---</div>`);
      if (`${window.postMessage}`.includes('[native code]')) {
        setTimeout(waitForBridge, 100);
      }
      else {
        window.postMessage(JSON.stringify(
          {
            "uid": "4342454", "key": "LOCATION_KEY"
          }));
      }
    }

    document.addEventListener("message", function (event) {
      const locationData = JSON.parse(event.data);
      html.insertAdjacentHTML('beforeend', `<div>data ${locationData.location.latitude}</div>`);
      html.insertAdjacentHTML('beforeend', `<div>data ${locationData.location.longitude}</div>`);

    });

    // let timeoutWaitForBridge = setTimeout(() => {
    //   waitForBridge();
    // });

    window.onload = waitForBridge;
    // setTimeout(waitForBridge, 6000);
  </script>
</body>

</html>